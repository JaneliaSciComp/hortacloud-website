<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><link rel=canonical type=text/html href=https://hortacloud.janelia.org/docs/user_manual/><link rel=alternate type=application/rss+xml href=https://hortacloud.janelia.org/docs/user_manual/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>User manual | HortaCloud</title><meta name=description content="How to use the Horta application
"><meta property="og:title" content="User manual"><meta property="og:description" content="How to use the Horta application
"><meta property="og:type" content="website"><meta property="og:url" content="https://hortacloud.janelia.org/docs/user_manual/"><meta itemprop=name content="User manual"><meta itemprop=description content="How to use the Horta application
"><meta name=twitter:card content="summary"><meta name=twitter:title content="User manual"><meta name=twitter:description content="How to use the Horta application
"><link rel=preload href=/scss/main.min.a9b55832fcac0ae4e1abebd8fa418b962048ce55d2fe39e8ecb37040471492c2.css as=style><link href=/scss/main.min.a9b55832fcac0ae4e1abebd8fa418b962048ce55d2fe39e8ecb37040471492c2.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<link rel=stylesheet href=/css/prism.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-00000000-0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo></span><span class=font-weight-bold>HortaCloud</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.2fb457ab72fdf1d27b97e8f6d219ac99.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/user_manual/>Return to the regular view of this page</a>.</p></div><h1 class=title>User manual</h1><div class=lead>How to use the Horta application</div><ul><li>1: <a href=#pg-2cc166fddc11bf2274cfaa7611dfdd8f>Concepts</a></li><li>2: <a href=#pg-02fee88c4b81e201bf16fb7a1e85955f>AppStream Basics</a></li><li>3: <a href=#pg-0c1d4d2c71a58e9bda291973835f8abd>Basic Operations</a></li><li>4: <a href=#pg-79b42b49477866bac32f7d6b422d54d7>Features</a></li><li>5: <a href=#pg-2b1961a5565e77677ad7d5e4b849b6ec>Reference</a></li></ul><div class=content><p>The sections below describe Horta&rsquo;s basic and advanced features. Generally the sections listed below should be read in the order listed.</p><h3 id=note-on-horta-versions>Note on Horta versions</h3><p>The Horta application exists in two versions that come from a common code base. The <em>cloud</em> version (HortaCloud) that is available here is a reduced version of the <em>desktop</em> version (<a href=https://github.com/JaneliaSciComp/workstation>Janelia Workstation</a>). In fact, we&rsquo;ll often use the word &ldquo;workstation&rdquo; to refer to the Horta application in either form.</p><p>When there are differences between the two versions, they will be noted with &ldquo;(HortaCloud)&rdquo; and &ldquo;(desktop)&rdquo;. If the differences are more substantial, they will be presented like this:</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>HortaCloud only</h4>In HortaCloud, the following control behaves differently from the desktop version.</div><div class="alert alert-primary" role=alert><h4 class=alert-heading>Desktop only</h4>The following features is only available in the desktop version of the Janelia Workstation.</div><p>The major user-visible differences between the two versions are:</p><ul><li>HortaCloud does not have access to the local file system or clipboard and requires additional steps to import or export data via those routes (see AppStream Basics section for details)</li><li>HortaCloud datasets typically only include low-resolution 2D data, so some 2D tools are not as useful or may not function in the absence of high-resolution data (eg, automatic path tracing)</li><li>the desktop Janelia Workstation contains tools for viewing, annotating, and managing other unrelated Janelia datasets</li></ul><div class="pageinfo pageinfo-info"><p>This is a work in progress!</p><p>The original documentation for the desktop version of Horta and the Janelia Workstation are being adapted for HortaCloud, and this website. If something doesn&rsquo;t make sense for HortaCloud, it probably only applies to the desktop version and hasn&rsquo;t been revised yet.</p></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2cc166fddc11bf2274cfaa7611dfdd8f>1 - Concepts</h1><div class=lead>High-level description of the data, the software, and the jargon</div><h2 id=data>Data</h2><p>Light microscopes of various kinds can now image an entire fly or mouse brain (eg, resonant scanning two photon with integrated vibrotome or Bessel light sheet). Horta is capable of displaying and annotating the resulting multi-terabyte datasets. The details of how the data should be prepared for use in Horta is covered in the <a href=https://hortacloud.janelia.org/docs/user_manual/reference/>Horta Reference</a> section. In general, though, the data will have these properties:</p><ul><li>size: generally limited by disk space (local or cloud)</li><li>channels: two channels are supported and tested; three channels are supported but not well tested; four or more channels are possible but would require more development</li><li>location: the data will be on a storage system accessible to the image server<ul><li>(HortaCloud) AWS S3 bucket</li><li>(desktop) local or networked storage available to the workstation servers</li><li>the file path to the data should be known to the user if they will be creating samples manually</li></ul></li><li>arrangement: the 2D and 3D images are arranged in multi-resolution octrees; details are covered in the reference section, but the user doesn&rsquo;t need to know them</li></ul><h2 id=software--tasks>Software & tasks</h2><p>Horta includes the Horta 2D viewer, which is the 2D, plane-by-plane, viewing and annotation tool, and the Horta 3D viewer, which supports viewing and annotating the data in three dimensions. The two viewers connect to common data editing and storage functions, many of which can be viewed in the Horta Control Center.</p><p>Horta is designed for a variety of tasks:</p><ul><li>viewing data: panning, zooming in and out, and scrolling through planes; brightness and contrast adjustment</li><li>skeletal tracing of neurons: tracer places connected points on the signal</li><li>text annotation: each point can have arbitrary text added to it</li><li>import/export: skeletons can be imported or exported as SWC files; text notes are imported/exported as JSON (see reference section for details)</li></ul><div class="alert alert-primary" role=alert><h4 class=alert-heading>Why the name 'Horta'?</h4>&ldquo;Horta&rdquo; is the name of a tunneling silicon based lifeform from the Star Trek original series episode 25 <a href=http://en.wikipedia.org/wiki/The_Devil_in_the_Dark>&ldquo;The Devil in the Dark&rdquo;</a>. Neuron traces in 3D resemble the tunnels such a creature might make in the ground. &ldquo;Horta&rdquo; can also be conveniently backronymed as &ldquo;How Outstanding Researchers Trace Axons&rdquo;.</div><h2 id=workflows>Workflows</h2><p>The basic tools can be used to implement a variety of workflows. For example, a user may trace a neuron entirely on their own. Or two users may trace the same neuron, export their results, and a later user may compare those results either by importing them both back in to the workstation or using other tools. If computational methods can trace neurons and export the results as SWC files, those results can be imported into the workstation for validation and/or correction and extension by later users. This flexibility supports neuron reconstruction at both small and large scales.</p><h2 id=jargon>Jargon</h2><ul><li>basic objects in Horta:<ul><li><code>sample</code>: the data; specifically, the object in the workstation that represents a particular image dataset; it&rsquo;s independent of user, and it&rsquo;s all you need if you are only viewing the data</li><li><code>workspace</code>: the object in the workstation that collects a set of annotations (traced neurons and text annotations); it is owned by a user or group, and it contains neurons</li><li><code>neuron</code>: the object that holds the traced neuron skeletons; a neuron usually contains one or more neurites</li><li><code>neurite</code>: a single skeleton or tree; a group of annotations with parent-child relationships, all tracing back to a single root without a parent</li><li><code>annotation</code>: a single point that may have zero or one parent and zero or more children; annotations are sometimes called anchors</li><li><code>tag</code>: a word or phrase attached to a neuron; it may be used in filtering the neuron list or in controlling neuron appearance</li><li><code>owner</code>: a username or group that owns the neuron; if a neuron is owned by a user, only they may change it; if a neuron is owned by a group, any member of the group may take sole ownership of the neuron (and then change it)</li></ul></li><li>data and data formats:<ul><li><code>tiles</code> or <code>octree</code>: the files holding the 2D data</li><li><code>ktx tiles</code>: the files holding the 3D data</li><li><code>SWC file</code>: a common multi-column text file format for storing neuron skeletons</li><li><code>JSON file</code>: a common structured text file format used to import/export text annotations</li></ul></li><li>tracing methods & workflows:<ul><li><code>manual</code>: a tracer clicks along the signal in the data to create a neuron skeleton</li><li><code>semi-automated</code>: a computer program partially traces the signal in a dataset; the fragments are imported into the workstation; a tracer connects and/or extends fragments as needed to produce the skeleton</li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-02fee88c4b81e201bf16fb7a1e85955f>2 - AppStream Basics</h1><div class=lead>Some general information about running HortaCloud in the AppStream environment</div><h2 id=the-appstream-environment>The AppStream environment</h2><p>In general, the AppStream environment behaves like a Windows desktop computer running a single application, Horta. Because it&rsquo;s running in a browser, though, there are some important differences. Many of them are managed via the AppStream toolbar at the top of the screen.</p><a href=../AppStream-toolbar.png><img src=../AppStream-toolbar.png class="rounded mx-auto" style=max-width:761px alt="AppStream toolbar"></a><h3 id=data-import-and-export-file-system-and-clipboard>Data import and export: file system and clipboard</h3><p>Web browsers are constrained with respect to how they read and write data on a computer, and applications running in virtual machines displayed in a browser, even more so.</p><p>File system access: the third icon from the left opens a dialog showing &ldquo;My Files&rdquo;, and within it, a &ldquo;Temporary Files&rdquo; location. This is a file location on the remote computer running Horta and Horta can read and write to. You can then transfer files from that location to your local computer via the &ldquo;My Files&rdquo; dialog box. See &ldquo;Importing Data&rdquo; and &ldquo;Exporting Data&rdquo; in the &ldquo;Basic Operations&rdquo; section for more details.</p><p>Clipboard access: if you copy anything in Horta to the clipboard, it&rsquo;s only accessible on the remote computer. The fourth icon from left on the toolbar will transfer the remote clipboard&rsquo;s contents to the local clipboard.</p><h3 id=windows-and-screens>Windows and screens</h3><p>Horta users often want to see the 2D and 3D views simultaneously, or they want a maximum 3D view while leaving room for the Data Explorer and/or Horta Control Center. To enable use of multiple monitors, click the seventh icon from left on the toolbar. There is also a full-screen mode enabled via the sixth icon.</p><p>The second icon on the toolbar shows all windows, in case you undock a Horta Window and then lose it behind a larger window. There&rsquo;s also a terminal window from which Horta is initially run; this can be ignored. If you close it, it will close Horta.</p><h3 id=quitting-and-relaunching-horta>Quitting and relaunching Horta</h3><p>Sometimes Horta does have issues. Often reloading data by reopening a workspace will clear them up. If not, to relaunch the application again without ending the AppStream session, choose File > Exit or click the &ldquo;x&rdquo; at top right. Then relaunch the application by clicking the first icon in the toolbar and choosing &ldquo;Horta Workstation&rdquo; again.</p><h3 id=ending-the-session>Ending the session</h3><p>To end the session, you can choose &ldquo;End Session&rdquo; from the drop-down menu on the top-right toolbar button.</p><p>Remember that when you end a session, some data that is stored on the remote computer will be lost:</p><p>Volatile data:</p><ul><li>files in &ldquo;MyFiles/Temporary Files&rdquo;</li><li>information on the clipboard</li></ul><p>All other data (sample data, workspace data, annotations, notes, etc.) is stored in the database and is not lost when a session ends.</p><div class="alert alert-warn" role=alert><h4 class=alert-heading>Data safety during development</h4><p>HortaCloud is still under development!</p><ul><li>there is some risk of database loss during upgrades<ul><li>any neurons should be exported to SWC for safety</li></ul></li><li>some settings/preference data will be lost when sessions end<ul><li>this will be moved into the database in a future release</li></ul></li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0c1d4d2c71a58e9bda291973835f8abd>3 - Basic Operations</h1><div class=lead>Description of some basic operations: how to navigate images, how to trace neurons in 2D and 3D, and how to import and export neuron data</div><p>This section will walk you through the process of tracing a neuron and some other tasks. It&rsquo;s meant to introduce you to the basic operations of Horta. Not all features or details of features are discussed. You can find those details in the appropriate <a href=https://hortacloud.janelia.org/docs/user_manual/features/>Feature</a> section.</p><h2 id=assumptions>Assumptions</h2><p>Before you get started with Horta, it is assumed:</p><ul><li>The data is available in the proper format.</li><li>If a sample hasn&rsquo;t been created, you know the file path to the data.</li><li>(HortaCloud) You have a HortaCloud username and password.</li><li>(desktop) The Janelia Workstation is installed, you have a username and password, and you have logged in after launching the workstation. You have set the memory used by the workstation to a large number, preferably 40G or more.</li><li>You&rsquo;ve read the <a href=https://hortacloud.janelia.org/docs/user_manual/concepts/>Concepts</a> section of this documentation.</li></ul><p>You should contact whomever prepared your data if you don&rsquo;t know the answers to the above questions.</p><h2 id=data-explorer-and-data-inspector>Data Explorer and Data Inspector</h2><p>When Horta is launched (either version), you will see the Data Explorer and Data Inspector at the left edge of the application window.</p><p>The Data Explorer panel lists all of the objects in the workstation that the user has permission to view. These objects include both samples and workspaces as well as folders used to organize them.</p><p>Single-clicking on an object in the Explorer will populate the Data Inspector with more details about the object. The <code>Attributes</code> tab shows object metadata. <code>Permissions</code> shows current access permission and, via the &ldquo;Grant permission&rdquo; button at the bottom, allows the user to share read or write (edit) permissions for the selected object. The <code>Annotations</code> tab is only used in the desktop application for datatypes not available in HortaCloud.</p><p>Right-clicking on an object brings up a menu of actions. Most are self-explanatory; others will be described later in this section or in one of the reference sections.</p><h2 id=basic-annotation>Basic annotation</h2><p>The most basic workflow for neuron tracing is this:</p><ul><li>Create a sample</li><li>Create a workspace</li><li>Create a neuron</li><li>Add points to the neuron</li><li>When done, export the neuron</li></ul><p>Those tasks, and others, are detailed below.</p><h2 id=creating-a-sample>Creating a sample</h2><p>A sample is the representation of a dataset in the workstation. This only needs to be created once per dataset and can be shared among all users who are annotating that dataset. You need to create a sample in order to view data.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>HortaCloud</h4>In HortaCloud, samples are usually already created automatically by the system.</div><ul><li>File menu > New > Tiled Microscope Sample</li><li>In &ldquo;Sample Name&rdquo;, enter a name for the sample</li><li>In &ldquo;Path To Render Folder&rdquo;, enter the path that the image server will use to locate the images. This should be a Linux-style path.<ul><li>(HortaCloud) The sample path will refer to a S3 bucket.</li></ul></li><li>Click &ldquo;Add Sample&rdquo;.</li><li>The sample will appear in your &ldquo;3D Tile Microscope Samples&rdquo; in your home folder. You may need to refresh the Data Explorer to see it.</li><li>(optional) <a href=broken-link-to-nonexistant-docs>Share the data</a> with other users or groups.</li></ul><p>Once it&rsquo;s been created, you may perform any operations on the sample that you can do with any other object in the workstation. For example, you may move, rename, or remove it. See the main workstation documentation for details.</p><h3 id=relocating-a-sample>Relocating a sample</h3><p>If, for any reason, the images for a sample change location or change name, you can update the path stored in the sample without recreating it. Right-click on the sample and choose &ldquo;Edit sample path&rdquo;.</p><h2 id=viewing-and-navigation>Viewing and navigation</h2><h3 id=opening-a-sample>Opening a sample</h3><ul><li>In the Data Explorer, browse to the sample.</li><li>Right-click the sample and choose &ldquo;Open in Horta&rdquo;.</li><li>This option loads both samples and workspaces.</li><li>The sample will open the Horta Control Center, which is typically docked at the right-hand side of the main window. When you open a sample (rather than a workspace), very little information will appear in the Horta Control Center.</li><li>To view the images in the sample, click the checkbox next to &ldquo;Open 2D&rdquo; or &ldquo;Open 3D&rdquo; near the top of the Horta Control Center (see screenshot below).</li><li>The viewer (2D or 3D) will open in the center panel. Depending on the data volume, network speed, and disk speed, the data may take anywhere from a few seconds to a few minute to open. The status bar at the bottom of the application will indicate some of the loading steps.</li><li>The 2D and 3D viewers each have their own tab, and you can switch between them freely.</li></ul><a href=../workspace-panel-1.png><img src=../workspace-panel-1.png class="rounded mx-auto" style=max-width:419px alt="workspace panel screenshot"></a><p>After you&rsquo;ve created a workspace (see below), use the same procedure to open the workspace.</p><h3 id=viewing-and-navigating-in-the-horta-2d-viewer>Viewing and navigating in the Horta 2D viewer</h3><p>Horta 2D displays the 3D data as a series of 2D planar images. It provides the usual suite of tools for viewing and navigating through the data. When zoomed out, a lower-resolution view of the data is displayed. When zoomed in, higher resolution images are loaded. Annotations are displayed when they are near the plane that is currently being displayed.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>HortaCloud 2D data</h4>In HortaCloud, usually only the lowest resolution of the 2D data is available. When a sample or workspace is loaded, a single image of the whole data set will be displayed at the lowest zoom level. If you zoom in, the image will become blurry.</div><a href=../LVV-toolbar.png><img src=../LVV-toolbar.png class="rounded mx-auto" style=max-width:296px alt="image toolbar"></a><p>The toolbar at the top of Horta 2D (screenshot above) indicates the current mouse mode. Usually it&rsquo;s the &ldquo;pen mode&rdquo; shown above, which is used for normal annotation. Hover the mouse cursor above each mode to get a description of what they do. This section assumes you are in &ldquo;pen mode&rdquo;. Holding down &ldquo;option&rdquo; will change to &ldquo;hand mode&rdquo; while the key is held down. This mode is useful for navigation.</p><ul><li>To pan the image, hold down option so hand mode is active, then left click and drag the image. Alternately, double-click the image in either mode to recenter at the selected point.</li><li>To zoom the image, do any of: hold down shift and use the mouse scroll wheel, drag the slider to the right of the image, click &ldquo;Zoom Min&rdquo; or &ldquo;Zoom Max&rdquo;, or (when zoom mode is selected from the toolbar) left-click to drag the area to zoom to.</li><li>To change planes, do any of: drag the slider under the image, click the arrows in the plane number indicator under the image, or scroll the mouse wheel when it is in plane change mode. Note that when you are zoomed out, each click of the mouse wheel will traverse more than one plane.<ul><li>Note that holding down the shift key will put the mouse scroll wheel into zoom mode, and releasing the shift key will place the mouse scroll wheel into plane change mode, regardless of the mode the mouse scroll wheel was in when the shift key was depressed.</li></ul></li><li>The &ldquo;Reset View&rdquo; button will recenter the image in x, y, and z and zoom out.</li><li>In the Horta Control Center, the &ldquo;Go to&mldr;&rdquo; button allows you to enter an x, y or x, y, z location, and the view will move to center itself at that point. If you don&rsquo;t enter z, the plane doesn&rsquo;t change. Commas are optional. Square brackets around the coordinates are ignored.</li></ul><h3 id=adjusting-colors-in-horta-2d>Adjusting colors in Horta 2D</h3><p>Controls for adjusting the color of each channel in the image appear below the image, below the plane slider.</p><p>Each channel can be shown or hidden (eye icon at far left), and its color can be change (color patch at far right, which will open a color choice dialog).</p><p>The three handles on each slider control the range of color mapped to the range of data. The three locks below the sliders will force each of those values to remain in sync across all channel individually.</p><p>At the bottom of the panel to the right of the 2D view area are two color-related buttons. The &ldquo;Auto Contrast&rdquo; button attempts to find a reasonable range of colors based on a simple histogram of the data. This almost never does a good job. The &ldquo;Reset Colors&rdquo; button returns the displayed color of each channel to its default value (ie, sliders at maximum, etc.). This is also rarely useful.</p><p>Note that the current colors, contrast settings, channel visibility and locks are not saved automatically! You must manually save changes by clicking on the gear menu and choosing &ldquo;Save Color Model To Workspace&rdquo; or &ldquo;Save Color Model As User Preference&rdquo;. As the desired settings usually depend on the characteristics of the individual sample, usually you will want to save the color model to the workspace, after which it will be automatically loaded when the workspace is opened. However, if you find there is a baseline color model you&rsquo;d prefer over the default (sliders set to min/middle/max), you may save to your preferences as a personal default.</p><p>On the same menu are options for saving or loading the color to/from disk.</p><h3 id=viewing-and-navigating-in-horta-3d>Viewing and navigating in Horta 3D</h3><p>The Horta 3D viewer is opened by clicking the checkbox next to &ldquo;Open 3D&rdquo; from within the Horta Control Center. At low zoom, lower resolution images are displayed. When zoomed in, higher resolution images are loaded. Annotations are displayed at all zoom levels.</p><p>To move around the volume:</p><ul><li>Single-left click anywhere (including on an annotation): center the volume on that point. Note that if you click on an annotation or near signal, Horta will find the depth in z of the point and center on it correctly. This allows you to follow a neuron by clicking along its length with minimal depth changing.</li><li>Left-click and drag: move the viewpoint in the view plane.</li><li>Middle-click and drag: rotate the volume</li><li>Scroll wheel: change the zoom level</li><li>Right-click anywhere and choose &ldquo;Reset Horta rotation&rdquo; if you would like to return to the original image orientation.</li><li>In the Horta Control Center panel, the &ldquo;Go to&mldr;&rdquo; button just above the neuron list allows you to enter an x, y or x, y, z location, and the view will move to center itself at that point. If you don&rsquo;t enter z, the plane doesn&rsquo;t change. Commas are optional. Square brackets around the coordinates are ignored.</li></ul><h3 id=horta-2d-and-horta-3d-view-synchronization>Horta 2D and Horta 3D view synchronization</h3><p>If both viewers are open, you may synchronize the views by right-clicking on a point in either viewer and choosing &ldquo;Synchronize Views at This Location&rdquo;. This command moves the point to the center of the screen in each view. The zoom level is not changed.</p><h3 id=adjusting-colors-in-horta-3d>Adjusting colors in Horta 3D</h3><p>Adjusting colors and the general appearance of the data in Horta 3D can be challenging. Horta 3D has been tested and used with one or two data channels. The mixing feature especially may not work with more channels.</p><h4 id=basic-settings>Basic settings</h4><p>To make basic color adjustments in Horta 3D, Windows menu > Horta > Color sliders. In the window that appears, you can adjust color sliders as you would for the Horta 2D. Usually you will want to hide the third channel in this case.</p><h4 id=unmixing>Unmixing</h4><p>Often the two data channels are used to display a desired signal in one channel and a reference in the other channel. However, fluorescence from the reference channel can also appear in the signal channel. Subtracting it out can make the signal substantially more distinct. To make use of this feature:</p><ul><li>Adjust the signal and reference channels independently (see note below) with the third channel hidden (click the eye to the right of the third slider)</li><li>Right-click and choose Tracing channel > Unmix channel 1 using current brightness (or 2, depending on which channel is which)</li><li>Hide the first two channels and unhide the third</li><li>Adjust the third channel&rsquo;s contrast and brightness</li></ul><p>Note: finding good contrast/brightness settings for the first two channels so the unmixing works well is quite difficult! In general, you should set the channel color slider for the signal channel so the brightest part of the signal (usually the soma) is oversaturated and work from there.</p><p>Color model settings are saved as in 2D (see <a href=#adjusting-colors-in-horta-2d>Adjusting colors in Horta 2D</a> above). Note that this saves a wider array of setting than for Horta 2D, including rendering options!</p><h3 id=navigating-to-neurons-or-annotations>Navigating to neurons or annotations</h3><p>Once you&rsquo;ve begun annotation, you can easily navigate to neurons or their constituent annotations (see below for how to annotate).</p><p><strong>Neurons</strong>: If you double-click on a neuron name in the neuron list, the view will center on the center of the neuron&rsquo;s bounding box. Note that if a neuron spans a lot of area and you are zoomed in, you may not see any of the actual neuron!</p><p><strong>Annotations</strong>: If you double-click on an annotation in the annotation list, the view will center on the annotation.</p><h2 id=basic-tracing-and-editing>Basic tracing and editing</h2><p>Annotations are stored in workspaces. A workspace is associated with a sample, which contains the images. You must create a workspace before annotating. Multiple workspaces may be associated with the same sample. For example, multiple people may trace the same neuron independently as a quality control check. Alternatively, a single workspace may be shared among multiple users, usually tracing different neurons simultaneously.</p><p>In general, only one tracer should be working on any given neuron at the same time, to prevent one tracer&rsquo;s work from being overwritten by another&rsquo;s. Horta attempts to prevent this from happening, but it is possible.</p><p><strong>Note</strong> Most editing and tracing tools are containing in the Horta Control Center panel at right. If you&rsquo;re working on a small display, you may need to use the panel&rsquo;s scroll bar to make some of the lower tools visible.</p><h3 id=creating-a-workspace>Creating a workspace</h3><a href=../workspace-panel-2.png><img src=../workspace-panel-2.png class="rounded mx-auto" style=max-width:257px alt="workspace panel screenshot"></a><p>To create a workspace:</p><ul><li>Open a sample from the Data Explorer; it will appear in the Horta Control Center.</li><li>In the workspace controls at the top of the editor panel at right (see screenshot above), click the &ldquo;+&rdquo; button.</li><li>Fill in the desired name for the workspace. By default, it has a structured name based on the date and other data. You may optionally click &ldquo;Manual override&rdquo; to name the workspace whatever you would like.<ul><li>(Note that &ldquo;Assign neurons&rdquo; has no effect for this method of creating a workspace.)</li></ul></li><li>The workspace will be created, and it will automatically immediately load in the Horta Control Center. The workspace name and sample name will appear in the workspace controls area. The workspace will also appear in the Data Explorer under &ldquo;Workspaces&rdquo; in your home directory (you may need to refresh the explorer).</li><li>Once the workspace has been created, you can open it again just like you&rsquo;d open a sample, by right-clicking the workspace in the Data Explorer and choosing &ldquo;Open in Horta&rdquo;.</li></ul><h3 id=operations-on-workspaces>Operations on workspaces</h3><p>You can perform a number of operations on the workspace. Some of these operations are common to all data in the workstation; these operations can be performed from the Data Explorer, typically by right-clicking on the workspace. These operations include moving, sharing, renaming, deleting the workspace.</p><p>Other operations are specific to Horta. These operations can be accessed by clicking the gear icon in the Horta Control Center, in the workspace information panel just above the neuron list. Most of these will be discussed in other sections.</p><p><strong>Save as</strong>: If you need to make a copy of the workstation and all the annotations within it, choose &ldquo;Save as&mldr;&rdquo; from the workspace gear menu. You will be prompted for a new name just as if you were creating the workspace from scratch.</p><h3 id=creating-or-deleting-a-neuron>Creating or deleting a neuron</h3><p>Annotations are contained within neurons. Typically a neuron in Horta represents one biological neuron. Usually its root annotation is placed on the neuron&rsquo;s soma. Neurons may contain more than one annotation tree, however. For example, it can be convenient to trace large arbors individually and link them later. Neuron controls and the neuron list are located below the workspace controls in the Horta Control Center (screenshot below).</p><a href=../neuron-panel.png><img src=../neuron-panel.png class="rounded mx-auto" style=max-width:419px alt="neuron panel screenshot"></a><p>To create a neuron:</p><ul><li>Open a workspace.</li><li>Click the &ldquo;+&rdquo; button below the neuron list.</li><li>Type in a name for the neuron and click &ldquo;OK&rdquo;.</li><li>The new neuron will appear in the neuron list, selected.</li></ul><p>To delete a neuron, select a neuron in the list, then click the &ldquo;-&rdquo; button below the neuron list. You will be shown a dialog box to confirm your decision.</p><h3 id=annotating-in-horta-2d>Annotating in Horta 2D</h3><p>To add points to a neuron in the Horta 2D viewer:</p><ul><li>Open a workspace.<ul><li>Create a neuron if one does not exist.</li></ul></li><li>In the neuron list, select a neuron by clicking on it.</li><li>Be sure you have the pen tool selected in the toolbar; this is the default, and it is rarely changed.</li><li>If there are no points in the neuron:<ul><li>Shift-left-click a location to place a point at that location.</li></ul></li><li>If there are already points in the neuron:<ul><li>Select the parent annotation you want to add a child to by clicking on it. The annotation will then be drawn with a &ldquo;P&rdquo; on it.</li></ul></li><li>Navigate to the location of the next annotation, possibly changing planes as you do.</li><li>Shift-click the location where the annotation should be placed.</li><li>A new point will be added, connected to its parent, and the new point will become the parent annotation for the next annotation added. In Horta 2D, this point is marked with a &ldquo;P&rdquo;.</li><li>The view will re-center on the new point.</li><li>Continue adding points by shift-clicking</li></ul><h3 id=annotating-in-horta-3d>Annotating in Horta 3D</h3><p>Adding points to neurons in the Horta 3D viewer is somewhat different than in the Horta 2D viewer because of the third dimension. In Horta 2D, when you add a point, it is added at the z-coordinate of the plane you are viewing. In Horta 3D, though, you are looking at a three-dimensional representation of the data, so a mouse-click might correspond to a number of locations in the data corresponding to various depths into the screen.</p><p><strong>Snap to signal</strong>: However, Horta 3D provides the user with assistance in placing annotations on signal. When you move the mouse cursor in Horta 3D, if it nears a bright signal (hopefully a labelled neuron and not background noise), the mouse cursor will change to a ball with a &ldquo;+&rdquo; sign, and it will jump to the center of the brightness automatically. If you shift-click to place a point, that point will be placed in three dimensional space on top of the brightest part of the data. In this way, you can annotate correctly in three dimensions without having to determine the exact depth of the signal manually.</p><p>Note that the &ldquo;snap to signal&rdquo; feature depends on which image channel has signal, and is therefore channel-dependent! Right-click and choose &ldquo;Tracing channel&rdquo; to determine whether signal is sought in the raw channels or a combination of multiple channels (average or unmixing; see above for unmixing details).</p><p>The complete procedure is then:</p><ul><li>Open a workspace.<ul><li>Create a neuron if one does not exist.</li></ul></li><li>Open the Horta 3D viewer</li><li>In the Horta Control Center, in the neuron list, select a neuron by clicking on it.</li><li>If there are no points in the neuron:<ul><li>Shift-left-click a location to place a point at that location in the LVV.</li><li>(need to replace this with horta 3D version!)</li></ul></li><li>Navigate to the location you want to annotate in Horta 3D.</li><li>Select the parent annotation you want to add a child to by clicking on it. The annotation will then be drawn with a &ldquo;P&rdquo; on it.</li><li>Navigate to the location of the next annotation, possibly rotating as you do. Move the mouse cursor to the location. A ball cursor with a &ldquo;+&rdquo; sign should appear.</li><li>Shift-click the location. Note that if there is no bright signal, the &ldquo;+&rdquo; cursor will not appear, and you will not be able to place an annotation!</li><li>A new point will be added, connected to its parent, and the new point will become the parent annotation for the next annotation added. This point is marked with a ball with a &ldquo;P&rdquo; on it.</li><li>The view will re-center on the new point.</li><li>Continue adding points by shift-clicking</li></ul><h3 id=editing-neurons>Editing neurons</h3><p>Horta contains several useful tools for manipulating neurons and annotations. Most of these operations are performed by right-clicking an annotation and choosing from the pop-up menu in one of the viewers. Some of the more commonly used actions are:</p><p>Mouse & keyboard actions:</p><ul><li><strong>Set next parent</strong>: left-click an selected annotation to set it to be the parent for the next added annotation</li><li><strong>Move annotation</strong>: to move an annotation, left-click and drag it to a new location</li><li><strong>Merge neurites</strong>: to merge one fragment with another, left-click and drag an annotation on top of another annotation; after a confirming dialog, the two neurites will be linked together between those two annotations<ul><li>The first neurite, with the dragged annotation, becomes a branch of the second annotation</li><li><strong>Note!</strong> The tolerance for this operation is quite small! This is best done zoomed quite far in.</li></ul></li><li><strong>Delete annotation</strong>: to delete the &ldquo;next parent&rdquo; annotation, press the delete key; this acts like the &ldquo;Delete link&rdquo; function, below; if no annotation is deleted, nothing happens</li></ul><p>Right-click menu actions (as named on the menu):</p><ul><li><strong>Delete link</strong>: deletes the clicked annotation; connects the annotation&rsquo;s parent and child; can&rsquo;t be used on branch points</li><li><strong>Delete subtree rooted at this anchor</strong>: deletes the clicked annotation and all annotations below it in the tree</li><li><strong>Split anchor</strong>: add a new annotation located between the clicked annotation and its parent; this annotation can then be dragged to a new location; this is used to annotate more densely after the fact</li><li><strong>Split neurite</strong>: break the neurite (neuron fragment) apart by removing the link between the clicked annotation and its parent; the clicked annotation becomes a root annotation</li></ul><h3 id=changing-neuron-appearance>Changing neuron appearance</h3><p><strong>Color</strong>: You can change the color of each neuron&rsquo;s annotations by clicking on the colored square in the neuron list (&ldquo;C&rdquo; column), by right-clicking the neuron in the neuron list and choosing &ldquo;Change neuron color&mldr;&rdquo;, or by right-clicking on one of its annotations and choosing &ldquo;Change neuron color&mldr;&rdquo;. In either case, you&rsquo;ll be presented with a dialog box that lets you choose the neuron color. If you choose &ldquo;Change neuron color&mldr;&rdquo; from the gear menu under the neuron list, you will change the color of all neurons currently visible in the neuron list.</p><p><strong>Visibility</strong>: It&rsquo;s often useful to hide some or most neurons from view. There are a variety of controls for accomplishing that.</p><p><em>Temporary</em>: To temporarily hide all neurons, hold down the &ldquo;v&rdquo; key. This function is useful for viewing the data under a neuron, often as it&rsquo;s being annotated.</p><p><em>Persistent</em>: Neurons can be toggled between visible and invisible (shown or hidden) for the duration of the annotation session (until the workspace is reloaded). There are multiple ways to do this:</p><ul><li>Right-click on an annotation and choose &ldquo;Hide neuron&rdquo;.</li><li>Click the eye icon in the &ldquo;V&rdquo; column in the neuron list; this column also indicates the current visibility of each neuron (open or closed eye).</li><li>Right-click the neuron name in the neuron list and choose one of the hide/show neurons options (show all, hide all, or hide all except the clicked neuron).</li><li>On the gear menu below the neuron list, choose one of the hide/show neurons options (show all, hide all, or hide all except the currently selected neuron). This will apply to all neurons currently displayed in the list</li></ul><h3 id=filtering-neurons>Filtering neurons</h3><p>The neuron list usually displays all neurons in the workspace, but its contents can be filtered to a subset of neurons, which is especially useful when the list is long.</p><ul><li><strong>Text filter</strong>: As you type characters into the box (2-3 or more), the list will update to show only neurons whose names contain the entered text somewhere in the name. Java regular expressions can be used.</li><li><strong>Ignore prefix</strong>: As you type characters into the box, the list will update to show only neurons whose names do not begin with the entered text. Again, regular expressions can be used.</li><li><strong>Tag filter</strong>: Neurons can be included or excluded from the displayed list based on their tags. See the &ldquo;Tags&rdquo; section in <a href=https://hortacloud.janelia.org/docs/user_manual/features/>Horta Features</a>.</li><li><strong>Spatial filter</strong>: When there are a large number of neurons (hundreds or more), perhaps computationally generated, performance can suffer if all of them are visible. Neurons can be filtered by spatial proximity to a neuron of interest. See the &ldquo;Spatial Filtering&rdquo; section in <a href=https://hortacloud.janelia.org/docs/user_manual/features/>Horta Features</a>.</li></ul><p>Note that any actions triggered from the gear menu below the neuron list will only act on neurons that are currently visible in the list! In this way, you can, for example, easily change colors or visibility of a specific subset of neurons.</p><p>The sort order of the neurons can be changed by choosing &ldquo;Sort&rdquo; from the neuron gear menu.</p><h3 id=filtering-annotations>Filtering annotations</h3><p>The annotation list is located below the neuron list in the right-hand panel. By default, it displays annotations that are &ldquo;interesting&rdquo;: roots, branch points, end points, and any annotation with notes (see below). Note that the &ldquo;geo&rdquo; column is meant to suggest the neuron&rsquo;s geometry (see below). They are ordered by last update time (newest at the bottom). Only annotations from the currently selected neuron are shown.</p><table><thead><tr><th>symbol</th><th>geometry</th></tr></thead><tbody><tr><td><code>o--</code></td><td>root</td></tr><tr><td><code>---</code></td><td>link</td></tr><tr><td><code>--&lt;</code></td><td>branch</td></tr><tr><td><code>--o</code></td><td>end</td></tr></tbody></table><p><strong>Filter menu and buttons</strong>: The filter menu lets you switch between several pre-determined filters (with buttons provided to quickly switch to some of those filters without navigating the menu).</p><p>Note that some of these filters do not operate the way you&rsquo;d think! They are designed to assist tracers to locate specific classes of annotations in conjunction with the note system (see below) and one possible workflow.</p><table><thead><tr><th>filter</th><th>included annotations</th></tr></thead><tbody><tr><td>default</td><td>roots, branches, ends, annotations with a note</td></tr><tr><td>ends</td><td>endpoint that do not have a note &ldquo;traced end&rdquo; or &ldquo;problem end&rdquo; (ie, an endpoint that needs to be traced out = unfinished endpoint)</td></tr><tr><td>branches</td><td>has &ldquo;branch&rdquo; note (ie, manually marked as a place that should be a branch point)</td></tr><tr><td>roots</td><td>is a root node</td></tr><tr><td>notes</td><td>has any note</td></tr><tr><td>geometry</td><td>roots, branches, ends</td></tr><tr><td>interesting</td><td>has &ldquo;interesting&rdquo; note</td></tr><tr><td>review</td><td>has &ldquo;review&rdquo; note</td></tr></tbody></table><p><strong>Filter text</strong>: As you type characters into the box, the list will update to only show annotations whose note contains the entered text somewhere in the note. Regular expressions may be used. Note that this filter also operates on the &ldquo;geometry&rdquo; column! For example, if you type <code>o–-</code> in the text filter, you will only see root annotations. This can also be done via the menu (above), but it may be useful in some cases.</p><h3 id=adding-notes-text-annotations>Adding notes (text annotations)</h3><p>Arbitrary text notes may be added to any annotation. To bring up the dialog box for adding, editing, or deleting notes: right-click on the annotation and choose &ldquo;Add, edit, or delete note&mldr;&rdquo;, double-click on the &ldquo;note&rdquo; column in the annotation list corresponding to the annotation, or select the annotation and press the assigned keyboard shortcut. In the dialog that pops up, you may enter any text you like. You may also edit or delete the note from this dialog.</p><p><strong>Predefined notes</strong>: There are a set of buttons that insert predefined notes (such as &ldquo;branch&rdquo;, &ldquo;interesting&rdquo;, and &ldquo;review&rdquo;). The predefined notes interact in important ways with the annotation filters. The details are described in the &ldquo;Notes&rdquo; section of Horta Features.</p><p>Notes are imported and exported along with the neurons (see below).</p><h3 id=changing-neuron-ownership>Changing neuron ownership</h3><p>There are two kinds of ownership in Horta. First is the ownership that is managed by the Janelia workstation itself. The items that appear in the Data Explorer (workspaces and samples) are shared using the &ldquo;Permissions&rdquo; tab in the Data Inspector window. A tracer must have write access to the workspace before annotating. (This is usually only relevant when sharing workspaces. A tracer always has write access to workspaces they create.)</p><p>The ownership of individual neurons, by contrast, is managed within Horta itself. The &ldquo;O&rdquo; column of the neuron list displays an icon corresponding to the neuron&rsquo;s owner: an icon of a head for another user, an icon of a computer for a generic &ldquo;system&rdquo; group, and nothing (no icon) for the current user. In all cases, if you hover your mouse over the icon (or empty space without an icon), a tooltip will show the full name of the owner.</p><p>First of all, most operations are prohibited when a neuron is owned by another user or a group that the current user is not a member of. This includes adding or deleting points or notes. Changing color or visibility is allowed, however, and those changes will not be seen by others.</p><p>Second, if a neuron is owned by a group, then any member of that group may make any changes to that neuron. When they do, they will also become the owner of the neuron automatically.</p><p>You may change the owner of a neuron if you own it, you are a member of the group that owns it, or you are designated as an administrator of the group that owns the workspace.</p><p>To change the owner of a neuron, single-click in the &ldquo;O&rdquo; column corresponding to the neuron in the neuron list.</p><p>This will be an icon or an empty space. From the dialog box, choose a new owner (user or group) for the neuron. To change the owner for multiple neurons, filter the neuron list to the desired set of neurons, then choose &ldquo;Choose neuron owner&mldr;&rdquo; from the gear menu under the neuron list.</p><p>Admins in the system may change any neuron&rsquo;s owner at any time.</p><p>The workspace gear menu contains the very dangerous &ldquo;Temp ownership admin&rdquo; checkbox which gives the user the ability to change neuron ownership as if they were an admin (but grants no other admin privileges). Use this sparingly! It&rsquo;s intended for use by a trusted and professional group to circumvent situations where a neuron owner is, eg, on vacation, and no admin is available to change it.</p><h2 id=exporting-data>Exporting data</h2><p>Horta use the SWC file format for importing and exporting neuron data. It&rsquo;s a multi-column text file that records the position and connectivity of the neurons and not much else. Note that an SWC file may contain more than one neuron or neuron fragment.</p><ul><li>To export all of the neurons in a workspace, choose &ldquo;Export SWC file&rdquo; from the gear menu in the workspace information area.</li><li>To export one specific neuron, right-click on the neuron name in the neuron list and choose &ldquo;Export SWC file&mldr;&rdquo;.</li><li>To export all neurons in the neuron list (potentially filtered), from the gear menu under the neuron list, choose &ldquo;Export neurons&mldr;&rdquo;.</li></ul><p><strong>Output files</strong>: In all cases, you will be prompted to choose an output location for the exported neuron(s).</p><ul><li>If you are exporting one neuron, it will be saved in the chosen location.</li><li>If you are exporting more than one neuron, two versions of the data will be exported:<ul><li>A single SWC named for the workspace that contains all of the neurons.</li><li>A folder named for the workspace that contains one SWC file for each individual neuron.</li></ul></li></ul><p><strong>Options</strong>: When exporting neurons, there are two options on the right side of the location choosing dialog box:</p><ul><li><strong>Point density</strong>: This option can be ignored unless you are using automatically traced paths (described elsewhere). Click &ldquo;Help&rdquo; for more info.</li><li><strong>Export notes</strong>: When this option is checked, any notes (text annotations) on the neuron are also exported in a JSON file. The file has the same name as the SWC file but uses the .json file extension instead of .swc.</li></ul><p>See the <a href=https://hortacloud.janelia.org/docs/user_manual/reference/>Horta Reference</a> section for details on the SWC and note file formats.</p><h2 id=importing-data>Importing data</h2><p>SWC files may be imported into Horta either interactively or in the background. Because importing large numbers of neurons can be time-consuming, importing more than a dozen or so neurons should be done in the background if you want to use Horta while the files are imported.</p><h3 id=interactive>Interactive</h3><p>Because an SWC file may store one or more than one neuron per file, and in Horta, you may have multiple neuron fragments per neuron, there are two ways to handle the import. Both of these options are found on the gear menu under the workspace information area.</p><ul><li><strong>Import SWC file as one neuron</strong>: This option reads all neurons in the SWC file(s), creates a single neuron, and places all neurons in the file in the newly created neuron (as what Horta calls neurites).</li><li><strong>Import SWC file as separate neurons</strong>: This option reads all neurons in the SWC file(s) and creates one neuron per root in the file(s).</li></ul><p><strong>Multiple files</strong>: In either case, you may choose either a single SWC file or a folder containing multiple SWC files. In the latter case, all SWC files in the folder are imported. Files in subfolders are not imported.</p><p><strong>Note</strong>: If the SWC file was exported from Horta and has an associated .json notes file, the notes will automatically be imported with the neurons.</p><h3 id=background>Background</h3><p>SWC files, especially large numbers of them, may be imported into a workspace that will be created for them in the background (on the server).</p><p>The SWC files to be imported must be collected in a folder that can be read by the workstation server.</p><ul><li>Right-click on the sample in the Data Explorer</li><li>Choose &ldquo;Import Linux SWC Folder into new Workspace on Sample&rdquo;</li><li>Give the new workspace a name in the first dialog box</li><li>(optional) Click the &ldquo;Assign Neurons&rdquo; box and provide a user or group that will be the owner of all the newly imported neurons</li><li>In the second dialog, enter the Linux file path to the folder containing the neurons.</li><li>(optional) There is a redundant check box to assign all neurons to the default common user group. In principle, this can be done from the previous dialog box as well.</li><li>After clicking OK, the import process will begin. It may show its progress in the &ldquo;Background Tasks&rdquo; tab.<ul><li>Do not attempt to load or use the workspace until the task completes!</li></ul></li></ul><p>Note that the import process will continue (on the server) even if you quit the workstation!</p><p>Important note: Unlike the interactive case, subfolders are recursively traversed, and all SWC files are imported!</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>HortaCloud imports and exports</h4><p>Because HortaCloud running via AppStream does not have direct access to the computer&rsquo;s hard drive, a two-step process must be used for importing and exporting SWC files and their associated JSON notes files. The process uses the &ldquo;My Files&rdquo; location in AppStream, which is a location for temporary files that last for the length of an AppStream session. If you click on the &ldquo;My Files&rdquo; folder icon on the top AppStream toolbar (screenshot below), a dialog box will open up. If you click on &ldquo;Temporary Files&rdquo;, it will open a folder where you can upload (via the button or by dragging) or download files (by clicking the downward-pointing arrow next to the filename). This &ldquo;Temporary Files&rdquo; location is visible from Horta, within any file dialog. So the process for importing SWC files is:</p><ul><li>Open &ldquo;My Files&rdquo;, then &ldquo;Temporary Files&rdquo;.</li><li>Upload SWCs by clicking &ldquo;Upload Files&rdquo; or by dragging.</li><li>In Horta, choose one of the SWC import options (see above), and navigate to &ldquo;Temporary Files&rdquo; in the file dialog.</li></ul><p>Export works the same way, in reverse: export to &ldquo;Temporary Files&rdquo;, then download from there.</p></div><a href=../AppStream-MyFiles.png><img src=../AppStream-MyFiles.png class="rounded mx-auto" style=max-width:318px alt="AppStream toolbar"></a></div><div class=td-content style=page-break-before:always><h1 id=pg-79b42b49477866bac32f7d6b422d54d7>4 - Features</h1><div class=lead>Horta features</div><p>This section discusses Horta features. It contains both details of basic operations that are covering in the <a href=https://hortacloud.janelia.org/docs/user_manual/basic_operations/>previous section</a> as well as descriptions of features that haven&rsquo;t yet been discussed.</p><h2 id=global>Global</h2><h3 id=preferencessettings>Preferences/settings</h3><p>There are a number of customization options for Horta.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>HortaCloud</h4>In HortaCloud, choose Tools > Options.</div><div class="alert alert-primary" role=alert><h4 class=alert-heading>Desktop</h4>If you&rsquo;re running Windows, choose Tools > Options if you&rsquo;re running Windows. On a Mac, the settings are called &ldquo;Preferences&rdquo; and are in the traditional place under the application menu at top right.</div><p>Here are some settings of interest:</p><ul><li><code>Core > Application</code>:<ul><li>Max Memory (desktop): This should be set to a high number, preferably 40G or more.</li><li>Max Memory (HortaCloud): This should be left blank; the system will set the memory correctly.</li></ul></li><li><code>Horta > Application</code>:<ul><li>&ldquo;Use http for file access&rdquo;: Must be left checked.</li><li>&ldquo;Load last opened sample&mldr;&rdquo;: This option is not currently working.</li><li>&ldquo;Verify neurons on load&rdquo; is never needed under normal circumstances. It can be enabled to check for some internal inconsistencies in neurons stored in the database.</li><li>&ldquo;Use anchors-in-viewport&rdquo; should be left enabled. This is a graphics optimization.</li><li>See below for &ldquo;Click mode for adding annotations&rdquo;</li><li>&ldquo;Z-slice thickness&rdquo;: The 2D view shown in Horta 2D actually shows annotations from multiple planes. This setting determines the depth of this effect. If you increase the number, annotations become visible on a large number of surrounding planes. Note however that there are some subtle behaviors in how the data and annotations are rendered, and changing this value dramatically away from its default value may not have the effect you want.</li></ul></li><li><code>Horta > Tile Loading</code>:<ul><li>In general, you can leave &ldquo;Concurrent tile loads&rdquo; and &ldquo;Number of tiles to cache&rdquo; to their defaults. Larger numbers <em>may</em> improve tile loading in Horta 3D.</li><li>See below for &ldquo;Click mode for adding annotations&rdquo;</li></ul></li><li><code>Keymap</code>:<ul><li>This section shows all of the user-changeable keyboard shortcuts for the Janelia workstation, including Horta. The shortcuts are listed by section.</li><li>New shortcuts will take effect after the application is restarted.</li><li>Note that some keyboard shortcuts in Horta cannot be changed from this dialog. Unfortunately, there is no central list of what they are.</li></ul></li></ul><h4 id=click-mode-for-adding-annotations>Click mode for adding annotations</h4><p>By default, to add annotations in Horta 2D and 3D, you select a parent annotation, then you shift-left-click on the desired location. For some people, holding down the shift key while making repeated annotations may cause stress on their hands, fingers, or wrists when done over a long period of time. For that reason, an option is provided to change that gesture to a simple left-click to add annotation (with no shift key). Note that this is set independently for Horta 2D and Horta 3D. The two settings are in different subpanels for historical reasons.</p><p>Note that if the &ldquo;left-click&rdquo; option is selected, some other behaviors in the two viewers will change, specifically those involving left-clicks. Most notably, in Horta 2D, idle clicks when (for example) closing right-click menus will register as an annotation.</p><p>Generally speaking, using the default group names:</p><ul><li>all users should be a member of <code>workstation_users</code></li><li>all users who want to interact with Horta samples or annotations should be a member of <code>mouselight</code></li><li>all regular Horta tracers should <em>also</em> be a member of <code>mouselight_tracers</code>; this group is used to populate some dialog boxes regarding neuron ownership, and project leadership, collaborators, and other non-tracers need not be in this group (it&rsquo;ll clutter the menus)</li></ul><h3 id=user-and-group-administration>User and group administration</h3><p>If you are an administrator, you can Windows > Core > Administration tool to manage users and groups. Note that these are users and groups within the Horta or Janelia Workstation applications. For HortaCloud, there is a second layer of users and administrator for AppStream that are managed separately.</p><p>An administrator within the Horta or Janelia Workstation system has a lot of power.</p><ul><li>see all data and assign permissions for all data</li><li>set privileges for all users and groups</li><li>use Tools > Admin > Run as&mldr; to connect as any user (usually used for debugging purposes)</li></ul><p>You should limit the number of people with admin privileges.</p><h2 id=horta-control-center-features>Horta Control Center features</h2><h3 id=notes>Notes</h3><p>Notes are text annotations that are attached to point annotations. They can be added, edited, or deleted from a dialog box triggered by a right-click on the annotation and choosing &ldquo;Add, edit, delete note&rdquo;. The contents can be arbitrary.</p><p>However, the note dialog does provide several pre-defined notes that can be used to support a simple tracing workflow. In addition, some of those pre-defined notes have specific effects on other operations and on the annotation filters.</p><table><thead><tr><th>predefined note</th><th>intended use</th><th>behavior</th></tr></thead><tbody><tr><td>traced end</td><td>to be added when the signal at that point has been traced as far as it can; it&rsquo;s a &ldquo;done&rdquo; marker</td><td><ul><li>must be placed on an endpoint</li><li>if another point is placed as a child, it&rsquo;s automatically removed</li><li>does not appear in the &ldquo;ends&rdquo; filter</li></ul></td></tr><tr><td>branch</td><td>to be added when the tracer finds a point where signal branches but doesn&rsquo;t want to follow the branch at that time; it&rsquo;s a &ldquo;come back to this&rdquo; marker</td><td><ul><li>cannot be placed on an existing branch</li><li>if another point is placed to make it an actual branch, it&rsquo;s automatically removed</li><li>does not appear in the &ldquo;branches&rdquo; filter</li></ul></td></tr><tr><td>interesting</td><td>indicates a point of interest</td><td>no special behavior</td></tr><tr><td>review</td><td>indicates a point that needs review by a second set of eyes, supervisor, or expert</td><td>no special behavior</td></tr><tr><td>problem end</td><td>indicates an endpoint that may or may not be able to be traced further by the current user; it&rsquo;s a &ldquo;done (but problematic)&rdquo; marker</td><td><ul><li>must be placed on an endpoint</li><li>if another point is placed as a child, it&rsquo;s automatically removed</li><li>does not appear in the &ldquo;ends&rdquo; filter</li></ul></td></tr><tr><td>(arbitrary text)</td><td>the user may place arbitrary text at any point</td><td>no special behavior</td></tr></tbody></table><p>All together, the notes and filters together were designed to support the following workflow:
- start tracing at a soma or a segment of interest
- add point along the segment
- at a branching point in the signal, add the &ldquo;branch&rdquo; note to the annotation to mark it as a point to be revisited; there is then no need to place a single point on the second branch to find it later
- when a branch ends in a synapse or becomes too faint to trace, place a &ldquo;traced end&rdquo; or &ldquo;problem end&rdquo; note, indicating that the tracing is complete for this branch
- if those notes are added consistently, then the &ldquo;branches&rdquo; and &ldquo;ends&rdquo; filters will identify those locations that need further work
- when those two filters have no annotations in them, the neuron is done</p><h3 id=tags>Tags</h3><p>Tags are user-defined, usually short, labels that are applied to neurons.</p><ul><li>To add or remove tags from a single neuron, right-click on the neuron in either the Horta 2D view or the neuron list and choose &ldquo;Edit neuron tags&rdquo;.<ul><li>The left &ldquo;Applied&rdquo; column contains tags that have already been applied to the neuron. Click on a tag in this column to removed it.</li><li>The right &ldquo;Available&rdquo; column contains existing tags that can be applied to the neuron by clicking on them.</li><li>To define a new tag, type the tag in the box below the &ldquo;Available&rdquo; column and click &ldquo;New tag&rdquo;. It will be created and applied immediately.</li><li>The list of &ldquo;available&rdquo; tags is the list of tags that exist on any neuron, plus two special tags.</li><li>The &ldquo;auto&rdquo; tag may be used freely. It is suggested to use this tag to mark neurons that were created by some automated process, to distinguish them from human-created neurons. When automatically created neurons are numerous, this can be used to filter them out (See &ldquo;Spatial filter&rdquo;).</li><li>The &ldquo;hidden&rdquo; tag is used internally and shouldn&rsquo;t be used.</li></ul></li><li>To add or remove a tag from multiple neurons, choose &ldquo;Edit tags&rdquo; from the gear menu in the neuron list. The tag will be added or removed from all the neurons in the filtered list, if applicable.</li><li>Tags can be used to filter the neuron list by either including or excluding neurons with a single tag.</li></ul><p>Tags can be used to control a few useful toggle behaviors. This feature is called &ldquo;Neuron group properties&rdquo;.</p><ul><li>First, add a tag to one or more neurons of interest using one of the above methods.</li><li>Right-click on a neuron and choose &ldquo;Edit neuron group properties&rdquo;.</li><li>The dialog box shows each user-applied tag as a &ldquo;Neuron group&rdquo; and indicates how many neurons are in the group.</li><li>Click on the cell in the third column of a row corresponding to a tag to assign a hotkey for the toggle.</li><li>Click on the fourth column to assign a toggleable property.</li><li>Click save. Now when keyboard focus is in Horta 2D, the hot key will toggle the property:<ul><li>Radius: the radii of the neuron(s) in Horta 3D will be toggled between their set size (either default or user-set) and a very thin radius</li><li>Visibility: the hotkey will hide or show the neurons(s)</li><li>Background: when this is toggled on, the neuron is placed in a &ldquo;background&rdquo; state that can be seen but not interacted with (ie, you cannot move, select, or add points to a background neuron)</li><li>Crosscheck: this is the same as &ldquo;background&rdquo; and &ldquo;radius&rdquo; together; it&rsquo;s designed to have a neuron visible but unobtrusive and unchangeable</li></ul></li><li>Note that this feature has been buggy in the past; sometimes you need to save repeatedly before the setting holds.</li></ul><h3 id=shared-workspaces--the-neuron-broker-updates>Shared workspaces & the Neuron Broker: updates</h3><p>When multiple users open and work in the same workspace, the Neuron Broker on the server acts as the intermediary for all changes to the database.</p><ul><li>It ensures that changes occur one at a time, in order.</li><li>It prevents users from changing neurons they do not own.</li><li>It broadcasts the results of changes to all users, so users in the same workspace can see changes made by other users.</li></ul><p>There are two elements of the UI that relate to the operation of the Neuron Broker.</p><ul><li>First, if &ldquo;Shared Updates&rdquo; is unchecked in the UI (in the right side panel of the Horta 2D view), then changes in the workspace will not be displayed until the &ldquo;Refresh&rdquo; button is clicked (same panel). This can be useful in the rare occasions that so many updates are arriving that it affects local performance. Normally, this should be left on.</li><li>Second, if the name of a neuron in the neuron list becomes italicized, that is an indication that the data in the workstation has become unsynchronized with the data in the database for that neuron. If you hover the mouse over the neuron name, it will tell you how many changes are not synced. Generally, if this occurs and does not clear after a minute or two, you should reopen the workspace. The unsynced changes will be lost, but the workspace will then be fully in sync with the database.</li></ul><p>See also &ldquo;Changing neuron ownership&rdquo; in the Horta Features section.</p><h3 id=spatial-filtering>Spatial filtering</h3><p>When a workspace has a large number of neuron fragments, such as those created by an automated segmentation process, two negative consequences may occur. First, the display becomes visually cluttered, and second and more important, performance of all kinds can degrade. These problems can be alleviated by only loading and displaying a small subset of all fragments in the region where the tracer is working. To enable spatial filtering:</p><ul><li>Click the gear menu under the neuron list and choose &ldquo;Set Neuron Filter Strategy&rdquo;.</li><li>The first check box enables or disables the filter.<ul><li>In all cases, only fragments owned by the tracing group are affected. Neurons owned by tracers (current tracer or other tracers) will always be loaded.</li></ul></li><li>There are currently two options for the filter:<ul><li>Proximity: fragments will be loaded if they are close to any non-fragment neuron.</li><li>Selection: fragments will be loaded if they are close to the last selected annotation.</li></ul></li><li>Distance: in either strategy, this controls how close fragments need to be to the target neuron(s) or point in order to be loaded.</li></ul><h3 id=task-workflow--neuron-cam>Task workflow & Neuron Cam</h3><p>This feature is still being developed and will be documented later.</p><h3 id=movie-maker-and-scene-editor>Movie Maker and Scene Editor</h3><p>The Horta Movie Maker is designed to created fly-through movies, typically for presentations. It is not supported and not documented at this time.</p><h2 id=more-horta-2d-features>More Horta 2D features</h2><h3 id=right-click-operations>Right-click operations</h3><p>Horta 2D has a number of operations on its right-click menu. Many of them are described elsewhere, especially in the <a href=https://hortacloud.janelia.org/docs/user_manual/basic_operations/>Horta Basic Operations</a> section. We will quickly summarize most of the operations here. Operations that are not documented below fall into two categories. First, some of them are redundant with other parts of the UI and are likely to be removed from the menu. For example, &ldquo;Begin new neurite here&rdquo; is unnecessary on the right-click menu. That operation is also documented in the Horta Basic operation section. Second, if an operation is not documented anywhere, it is deprecated and likely to be removed entirely, not just from this menu. Some of these will be noted explicitly.</p><h4 id=right-click-in-empty-space>Right-click in empty space</h4><p>Some options appear when you click in empty space in the 2D view, with no annotation under the mouse pointer.</p><ul><li>Scroll through Sample (Z): The camera will move to the lowest plane (smallest z) at the mouse pointer location and smoothly move through the planes until it reaches the highest plane. The zoom level is not changed.</li><li>File: All the operations on this menu are deprecated and should not be used.</li><li>Copy (various): When any of these options are selected, information about the location of the mouse pointer is copied to the clipboard. Note that for HortaCloud, the data is copied to the AppStream clipboard, and you must click the icon in the toolbar to copy it to the clipboard of your local computer<ul><li>Micron coords: the x, y, z location in µm in this form: <code>[75556.8, 43819.6, 23460.8]</code></li><li>Octree location: the location in the file hierarchy of the 2D tile under the mouse pointer. See the Horta Reference section for more details on the file layout. The format is this: <code>/5</code></li><li>Raw file tile location: the file path to the raw microscope tile that produced the rendered data under the mouse pointer, if available.</li><li>Octree filepath: the file path to the rendered tile under the mouse pointer.</li></ul></li><li>Task Workflow: see below</li><li>View: The view submenu replicates a number of buttons on the Horta 2D toolbar and side navigation panel. It is redundant and likely to be removed at some point in the future.</li></ul><h4 id=right-click-on-an-annotation>Right-click on an annotation</h4><p>If you right-click on an annotation in Horta 2D, a longer set of operations appears in addition to those described above. Note that an annotation will become visibly slightly larger when the mouse pointer is over it, indicating that the annotation will be the target of the click. Again, some of the operations are either deprecated or may be removed from the menu.</p><ul><li>Trace path to parent: generate an automatically traced path from the selected annotation to its parent (see &ldquo;Automatic point refinement and tracing&rdquo;, below)</li><li>Delete subtree: deletes the annotation under the mouse pointer and all annotations in the tree below it</li><li>Delete link: deletes the annotation under the mouse pointer if it is an endpoint, an isolated single point, or a point with a single parent and child (in which case the parent and child are connected). You cannot delete a branch point or a root point with children; use &ldquo;delete subtree&rdquo; instead.</li><li>Merge chosen neurite&mldr;: see &ldquo;Smart merge&rdquo; below</li><li>Transfer neurite: As described in Horta Concepts, a &ldquo;neurite&rdquo; is a structure rooted at a single root annotation, while a &ldquo;neuron&rdquo; is a container that may hold several neurites. This operation moves the selected neurite to another existing neuron (chosen from a dialog), or to a newly created neuron, which you are prompted to name.</li><li>Split anchor: This operation creates a new annotation between the selected annotation and its parent, placed close to the selected annotation. It&rsquo;s used to increase the density of points in the neuron.</li><li>Split neurite: This operation splits the current neurite into two, with the selected annotation cut from its parent into a new root.</li><li>Add, edit, delete note: See &ldquo;Notes&rdquo; section below.</li><li>Edit neuron tags/group properties: See &ldquo;Tags&rdquo; section below.</li><li>Generate neuron review tree/Select point in Task View: See &ldquo;Task workflow&rdquo; section below.</li><li>Set neuron radius: This operation allows the user to set the radius associated with the annotation. By default it is set to 1.0 µm.</li></ul><h3 id=automatic-point-refinement-and-path-tracing>Automatic point refinement and path tracing</h3><div class="alert alert-primary" role=alert><h4 class=alert-heading>Desktop only</h4><p>These features only work in the desktop version of Horta. HortaCloud data does not contain the high-resolution 2D data needed to make them work.</p><p>If you are working on a rare dataset that <em>does</em> have the full 2D octree in HortaCloud, it should work.</p></div><ul><li>Automatic point refinement: This option can be toggled on and off from the gear menu in the workspace information area. It only applies to Horta 2D.<ul><li>When this feature is toggled on, annotations will be placed at the x, y location of the click as usual. However, the annotation will be placed on the z-plane which has the brightest signal in the first channel within five planes of the click.</li></ul></li><li>Automatic path tracing: This option can be toggled on and off from the gear menu in the workspace information area.<ul><li>When this feature is toggled on, when the user adds a new annotation, Horta 2D places an additional set of annotations between the new annotation and its parent.</li><li>The &ldquo;automatic path&rdquo; is calculated automatically to follow the signal in three dimensions in the first channel using an A-* (A-star) algorithm. The details are contained in the reference section. The points are placed densely, approximately one pixel apart.</li><li>These paths are also drawn in a different style than the links between manually-placed points.</li><li>While the toggle is active, the paths are automatically recalculated whenever any manually-placed annotation changes. So if an annotation is moved by hand, all of the links to its parent and children will be updated with new automatic paths.</li><li>If you are using this feature, you should place annotations not too far apart. The algorithm is limited so it will not run more than a handful of seconds, and if points are too far apart, the algorithm may not find a path before it runs out of time.</li><li>These points may be exported as other points are. The &ldquo;Export SWC&rdquo; dialog contains one option to let you control how many points are exported. The &ldquo;Point density&rdquo; value should be set to 0 if you don&rsquo;t want to export any automatically placed points, set to 1 if you want to export all of them, or to a positive integer n if you want to export every nth point.</li></ul></li></ul><p>Note that you may request an automatic path tracing from an annotation to its parent explicitly from the right-click annotation menu.</p><h3 id=smart-merging>Smart merging</h3><p><strong>Note</strong>: this feature is experimental!</p><p>When presented with a large number of neuron fragments that must be assembled into reconstructed neurons, such as those provided by automated image analysis, the amount of time merging each neuron pair should be minimized. The &ldquo;smart merge&rdquo; feature tries to make it easier for the user to do a large number of repeated merges.</p><ul><li>To use this feature, select any point on the first neuron fragment. Then right-click on any point in the second neuron fragment and choose &ldquo;Merge chosen neurite to selected neurite&rdquo;.</li><li>Horta 2D will attempt to find the two endpoints in the two fragments that are closest.</li><li>Horta 2D will then move the point selection (the next parent selection) to the farthest endpoint in the merged neuron.</li></ul><h3 id=arrow-key-navigation>Arrow key navigation</h3><p>You may navigate along the neuron backbone in Horta 2D using the arrow keys. With a point in a neuron selected (set as next parent), pressing an arrow key moves the selection to another point and recenters the screen on that point.</p><ul><li>Right arrow: moves to the next branch point or endpoint farther away from the neuron root; if there are multiple possible branches, the first is followed (see below)</li><li>Left arrow: moves to the previous branch point or root toward the root</li><li>Alt + left/right arrow: as before, but move by only one point instead of until next branch/root/end</li><li>Up/down arrows:<ul><li>In general, the up and down arrows move you among parallel branches</li><li>When on a neuron segment that has another segment in parallel (another segment with the same branch point parent), move to the next such branch in sequence, positioned at the first point beyond the branch point.</li><li>When on a branch point or root, or segment without parallel branches, does nothing.</li></ul></li><li>The order of branches in all cases (&ldquo;first&rdquo; for right arrow, or parallel branches for up/down arrow) is determined by the order the children of the branch appear in internal data structures</li></ul><h3 id=other>Other</h3><p>The &ldquo;Volume cache&rdquo; checkbox and &ldquo;Clear cache&rdquo; button to the right of the 2D view area should generally be ignored.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>Desktop</h4>Since the desktop version of Horta uses the full 2D octree, prolonged browsing in the 2D view can fill up the 2D tile cache. Usually the system will clear its cache automatically, but in rare cases, when the cache is near full, the system will spend too much time managing the cache relative to loading tiles, and performance will suffer. When noticing a slowdown in tile loading, the user can press &ldquo;Clear Cache&rdquo;, and this may alleviate the issue.</div><h2 id=more-horta-3d-features>More Horta 3D features</h2><h3 id=right-click-operations-1>Right-click operations</h3><p>Horta 3D has a number of operations on its right-click menu. As with Horta 2D, some appear only when you right-click over an annotation, and others appear all the time. The options that always appear relate to display, and they are described below in &ldquo;Display options&rdquo;.</p><p>The operations that pertain the the annotation (anchor) or neuron under the mouse pointer replicate the corresponding functions in Horta 2D&rsquo;s UI (see above).</p><h3 id=display-options>Display options</h3><p>There are a number of view options that can be adjusted in Horta. Many of them are located on the right-click menu under &ldquo;View&rdquo;.</p><h4 id=view--projection>View > Projection</h4><ul><li>Maximum Intensity Projection (MIP) is the default display projection mode in Horta. MIP projection provides a robust, informative view of volumetric imagery data, under a wide variety of brightness settings.</li><li>Occluding projection (&ldquo;true&rdquo; volume rendering) can convey a better sense of relative depth, compared to MIP, which can be useful for discriminating neurites that approach one another closely in space. The downside of this superior display quality is that it is very sensitive to the exact brightness settings. The user should probably adjust the brightness settings (Window->Horta->Brightness), especially the minimum intensity value, before switching to the &ldquo;Occluding&rdquo; mode.</li></ul><h4 id=view--rendering-filter>View > Rendering Filter</h4><p>Horta provides three sub-voxel filtering options: Nearest Neighbor, Trilinear, and Tricubic. These filtering options can be used to trade off speed for image quality.</p><ul><li>Nearest-neighbor filtering shows the individual voxels of the raw image tile as discrete blocks. This mode is not particularly useful for visualization, but it is fast, and it is very useful for debugging, and for directly demonstrating the true spatial resolution of the underlying imagery data.</li><li>Trilinear filtering, the default option, interpolates between adjacent voxel intensities using a fast hardware-accelerated computation. This is a good compromise between render speed and image quality.</li><li>Tricubic interpolation is significantly slower than trilinear interpolation, but yields a smoother appearance, which can make it easier to see the true structure of the tissue being observed.</li></ul><h4 id=other-view-options>Other View options</h4><ul><li>View > Stereo3D lets you choose between multiple methods of displaying images if you have appropriate 3D hardware support.</li><li>View > Compress voxels in z: This option, when checked, compresses voxels in the z direction to make them appear more cubic. Normally, the data has a worse resolution in z, giving the image volume a stretched look. The user may choose which appearance they prefer.</li><li>View > Save viewer settings: If you make changes to the color sliders, tracing channel settings, or any other Horta view settings, you must choose this command to save those changes.<ul><li><strong>Note</strong>: unlike Horta 2D color model settings, which are saved with the workspace, these settings are save on a per-user basis! If you switch to another workspace, the same Horta color settings will be used.</li></ul></li><li>Tracing channel: As described in Horta Basic operation, annotation in Horta 3D is assisted by Horta 3D&rsquo;s &ldquo;Snap to Signal&rdquo; feature. This menu allows the user to choose which channel or combination of channels will be used to determine signal brightness.</li></ul><h4 id=tiles>Tiles</h4><p>The tiles submenu controls loading of the 3D data tiles. Note that in normal operation, tiles are loaded automatically as you navigate through the volume, typically displaying 5-8 tiles surrounding the last mouse click.</p><ul><li>Tiles > Load Horta Tile at Cursor/Focus: Force load a tile at either the center of the screen (Focus) or the location of the mouse cursor; occasionally useful if the automatic algorithm isn&rsquo;t doing what you want.</li><li>Tiles > Prefer rendered ktx tiles: When checked, Horta will prefer to load the ktx file format tiles. This is the default; ktx tiles load much faster than the alternative raw tiles. If this setting is unchecked, raw tiles, if available, will be loaded instead. Note that you must save viewer settings and restart the application if you change this setting.</li><li>Tiles > Clear all volume blocks: Choosing this operation forces all tiles to be discarded from the screen and cache and reloaded.</li><li>Auto-load image tiles: When checked, tiles are loaded automatically as you navigate; when unchecked, you must manually specify load of each desired tile using the other operations (Load at Cursor or Focus).</li></ul><p>Normally the user will not change any of these options or use any of these operations.</p><h4 id=horta-3d-auxiliary-windows>Horta 3D auxiliary windows</h4><p>Horta 3D has a number of panels containing a variety of supplemental controls. They can be opened from the Window menu > Horta. All of them can be undocked, moved, and redocked anywhere you like.</p><ul><li>Horta 2D, Horta 3D: opens the view window but does not load any data (if data has already been loaded, it will be visible)</li><li>Camera Control: provides another way to control the camera in Horta 3D<ul><li>Center focus, rotation, and zoom: replicate mouse commands</li><li>View Slab: adjusts how thick the visible slab of data is; the default preset II shows a nice chunk of data; preset I shows a very thin slab, closely resembling the 2D view</li></ul></li><li>Color Sliders: used to adjust the color settings for the image data channels and the tracing channel (as described in Horta Basic operation</li><li>Movie Maker and Scene Editor: not supported or documented</li><li>Graphics Speed: used for debugging; displays some graphics performance data</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2b1961a5565e77677ad7d5e4b849b6ec>5 - Reference</h1><div class=lead>Horta reference</div><h2 id=importexport-file-formats>Import/export file formats</h2><h3 id=swc>SWC</h3><p>The swc file format is a standard format for recording neuron skeletons. Unfortunately, while the basic format is widely used, there is no single standard for defining the format, and as a result, there are differences in implementation among various swc writers and readers. The basic spec can be seen <a href=http://www.neuronland.org/NLMorphologyConverter/MorphologyFormats/SWC/Spec.html>here</a>.</p><p>In summary, an SWC file:</p><ul><li>is a text file</li><li>contains a number of header lines, each beginning with a &lsquo;#&rsquo; character</li><li>followed by a list of points, one per line, with parents preceding children</li></ul><p>Each line consists of seven numbers separated by whitespace in the following order: <code>id type x y z radius parent</code>, with:</p><table><thead><tr><th>field</th><th>value</th></tr></thead><tbody><tr><td>id</td><td>integer identifying the point, in ascending order</td></tr><tr><td>type</td><td>integer indicating the type of the previous segment, with:<br>0 = undefined<br>1 = soma<br>2 = axon<br>3 = dendrite<br>4 = apical dendrite<br>5 = fork point<br>6 = end point<br>7 = custom</td></tr><tr><td>x, y, z</td><td>floating point coordinates of the point</td></tr><tr><td>radius</td><td>floating point radius of the previous segment</td></tr><tr><td>parent</td><td>id value of the parent for the current point; a root point has parent = -1</td></tr></tbody></table><p>Notes:</p><ul><li>two fields are non-critical for rendering the basic neuron skeleton:<ul><li>the <code>type</code> field describes but does not affect connectivity and can usually be ignored</li><li>the <code>radius</code> field does not affect connectivity; it&rsquo;s only necessary if you are rendering neuron volumes (skeletons with width)</li></ul></li><li>a node&rsquo;s <code>id</code> must appear in the <code>id</code> column before it appears as a <code>parent</code>; that is, child nodes must appear lower in the list than parent nodes</li></ul><h4 id=janelia-specific-details>Janelia-specific details</h4><ul><li>Only nodes with <code>type</code> 5 and 6 are marked by Horta, as they are the only types that can be inferred from geometry at export time. All other points are marked as <code>type</code> 0. On import, the <code>type</code> column is ignored.</li><li>Coordinates and radii are assumed to be in microns.</li><li>A few headers are used by Horta:<ul><li><code>ORIGINAL_SOURCE</code>, a fairly standard header, is set to &ldquo;Janelia Workstation Large Volume Viewer&rdquo;<ul><li>That is the original name for the software, back when it was only 2D, and we decided not to change this identifier.</li></ul></li><li>The x, y, z locations of the nodes are centered on the origin at export time because not all SWC viewers can handle the large coordinates (Horta can). The header field <code>OFFSET</code> gives the x, y, z offset needed to reproduce the original annotation location. The values are whitespace-delimited floating point numbers. Horta correctly handles this field during its own import and export; it will always use the field on export, but it doesn&rsquo;t complain if it&rsquo;s missing on import. If an swc reader ignores this header, the neuron will be of correct shape but shifted in space from its original location.</li><li>The color of the exported neuron (optional) is recorded in the header field <code>COLOR</code> as a comma-separated list of floating point RGB values ranging from 0 to 1.</li><li>Other headers are ignored at import.</li></ul></li><li>The name of the neuron is not stored inside the swc file. However, when imported, the neuron will be named like the swc file.</li></ul><p>Here is an example swc file:</p><pre tabindex=0><code># ORIGINAL_SOURCE Janelia Workstation Large Volume Viewer
# OFFSET 76290.282407 42379.443335 23460.277313
# COLOR 0.501961,0.000000,1.000000
1 0 -870.258314 84.790733 0.000000 1.000000 -1
2 0 -408.096941 6.007367 0.000000 1.000000 1
3 5 54.064431 -72.775998 0.000000 1.000000 2
4 0 232.512856 -256.688292 0.000000 1.000000 3
5 6 600.186790 -429.961032 0.000000 1.000000 4
6 0 159.078322 142.548313 0.000000 1.000000 3
7 6 232.512856 526.078910 0.000000 1.000000 6
</code></pre><h3 id=json>JSON</h3><p>When neurons are exported from Horta in swc format, any notes attached to the neuron&rsquo;s points are also exported. The notes are contained in a JSON file of the same name as the swc file but with a &ldquo;.json&rdquo; extension. The JSON file contains a dictionary with the following fields:</p><ul><li>workspaceID: contains the integer workspace ID number</li><li>username: contains the workstation username of the user doing the export</li><li>offset: contains a list of floating point numbers [x, y, z] holding the offset as described in the section above</li><li>neurons: contains a list of dictionaries, one per neuron exported; each dictionary has fields:<ul><li>neuronID: contains the integer neuron ID number</li><li>notes: contains a list of neuron notes; each note is a list of [x, y, z, note]</li></ul></li><li>on import, the username and workspace and neuron IDs are ignored</li></ul><p>The x, y, z, coordinates of each note will match the coordinates of the corresponding annotation in the corresponding swc file, as they use the same offset system. Horta automatically imports and exports the JSON files when the swc files are imported or exported.</p><p>Here is an example JSON file that corresponds to the above example swc file:</p><pre tabindex=0><code>{
  &#34;workspaceID&#34; : 2229358932059488401,
  &#34;username&#34; : &#34;olbrisd&#34;,
  &#34;neurons&#34; : [ {
    &#34;neuronID&#34; : 2653026075256291473,
    &#34;notes&#34; : [ [ 232.51285642151197, 526.0789095035507, 3.637978807091713E-12, &#34;traced end&#34; ], [ 232.51285642151197, -256.68829229611583, 3.637978807091713E-12, &#34;interesting&#34; ] ]
  } ],
  &#34;offset&#34; : [ 76290.28240663109, 42379.443335160235, 23460.2773125 ]
}
</code></pre><h2 id=image-file-formats>Image file formats</h2><h3 id=raw-tiff-stacks>Raw tiff stacks</h3><p>The raw microscope data is stored in tiff stacks. They can be displayed in Horta 2D on demand, but they are typically used only in rare instances when stitching in the rendered images is not perfect. Typically this data is only available in the desktop version of the software at the site the sample was imaged.</p><p>Details of the files and their organization will be added later.</p><h3 id=rendered-2d-images>Rendered 2D images</h3><p>The raw microscope data is transformed and stitched together into a contiguous rendered whole. It&rsquo;s also stored in tiff stacks, rendered at multiple resolutions and arranged in an octree. For HortaCloud, this data likely only has the a single low-resolution image for each channel.</p><p>Details of the files and their organization will be added later.</p><h3 id=horta-3d-images-ktx-files>Horta 3D images (ktx files)</h3><p>Horta&rsquo;s 3D images are optimized for fast loading into the Horta viewer. The ktx file format is designed to load directly into graphics cards. In order to keep the files both small enough to load rapidly and small enough to economically store, the rendered data is transformed and down-sampled before ktx tile creation. These files are also arranged in an octree, although currently Horta only uses the highest resolution images.</p><p>The file format is managed by the Khronos Group and is described <a href=https://www.khronos.org/api/index_2017/ktx>here</a>.</p><p>Horta-specific details will be added later.</p><h2 id=a-algorithm-for-automatically-traced-paths>A* algorithm for automatically traced paths</h2><p>The algorithm for computing the path is:</p><ul><li>Extract a rectangular solid block of voxels containing the two endpoints, plus a small buffer region in all three dimensions. (Thus, if the neuron meanders outside of this block, the technique will not work well. Try to choose anchors with relatively straight connections between them.)</li><li>Measure the variation in voxel intensity within that block: record mean and standard deviation.<ul><li>Currently, only the first channel is examined!</li></ul></li><li>Assume that the background (non-neuron) intensities follow a normal distribution, with the measured parameters (mean and standard deviation).</li><li>Define the path weight for a particular voxel, as the probability that an intensity greater than or equal to the voxel intensity, could have arisen randomly from the background distribution. Thus dim voxels get a large path weight, and bright voxels get a small path weight. This value can get extremely small for very bright pixels (think 10 raised to the minus seventy power). You can think of this weight as (1.0 minus the probability this voxel is a neuron), assuming all voxels are either background or neurons.<ul><li>weight = erf( (intensity - mean) / (standard_deviation) ), where erf() is the <a href=http://en.wikipedia.org/wiki/Error_function>error function</a>.</li></ul></li><li>Because it uses the mean and standard deviation of intensities, this method of path weighting is robust in the face of large uniform intensity bias offsets, like we sometimes see in the mouse brain imagery.</li><li>Use the <a href=https://en.wikipedia.org/wiki/A*_search_algorithm>A* (A-star) algorithm</a> to compute the lowest cost path connecting the two endpoints. This path is guaranteed to be optimal.</li><li>The algorithm will be terminated if it takes more than 10 seconds to finish.</li></ul><h2 id=user-groups-for-ownership-purposes>User groups for ownership purposes</h2><p>There are two user groups in the workstation that are used in neuron ownership operations. They are set at compile time to values specified in the <code>console.properties</code> file.</p><pre tabindex=0><code>console.LVVHorta.tracersgroup=group:mouselight
console.LVVHorta.activetracersgroup=group:mouselight_tracers
</code></pre><ul><li>The &ldquo;tracersgroup&rdquo; variable should be set to a group that contains all of the people using Horta to trace neurons. If a neuron is owned by this group, any member of the group can take ownership immediately. This group is expected to be used for ownership of samples and workspaces as well, so it may contain people who are not tracers but who will be looking at the same data and/or the tracers&rsquo; work.</li><li>The &ldquo;activetracersgroup&rdquo; variable should be set to a group containing only people who are tracing. The members of this group will be listed in some neuron ownership change dialogs for convenience.</li><li>If either group does not exist in the workstation database, the corresponding features will be disabled.</li><li><strong>Note</strong>: This scheme assumes that all tracers are members of one group that shares data freely. If you need to support multiple groups that will not be sharing data, you should currently deploy separate infrastructure (servers, etc) to support each group.</li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/hortacloud-support aria-label="User mailing list"><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/HortaCloud aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/JaneliaSciComp/hortacloud-website aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://scicomp-software.slack.com/archives/C03BZ177717 aria-label=Slack><i class="fab fa-slack"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 Howard Hughes Medical Institute /</small>
<small><a class=text-white href=https://www.hhmi.org/privacy-policy target=_blank rel=noopener>Privacy Policy & Cookie Notice</a></small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin=anonymous></script>
<script src=/js/prism.js></script></body></html>