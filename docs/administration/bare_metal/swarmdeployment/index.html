<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Deploying JACS | HortaCloud</title>
<meta name=description content="Deploying the JACS services using Docker Swarm
"><meta property="og:url" content="https://hortacloud.janelia.org/docs/administration/bare_metal/swarmdeployment/"><meta property="og:site_name" content="HortaCloud"><meta property="og:title" content="Deploying JACS"><meta property="og:description" content="Deploying the JACS services using Docker Swarm"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-05-10T21:41:37-04:00"><meta itemprop=name content="Deploying JACS"><meta itemprop=description content="Deploying the JACS services using Docker Swarm"><meta itemprop=dateModified content="2022-05-10T21:41:37-04:00"><meta itemprop=wordCount content="1018"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying JACS"><meta name=twitter:description content="Deploying the JACS services using Docker Swarm"><link rel=preload href=/scss/main.min.55d6a7060342ee00f397dcdc958ab401a1e2a2a92d8baec7ba45906976f8ce8b.css as=style><link href=/scss/main.min.55d6a7060342ee00f397dcdc958ab401a1e2a2a92d8baec7ba45906976f8ce8b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-00000000-0")}</script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>HortaCloud</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about/><span>About</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.3b8bbf97f78f29f4c7603ca4fa26689d.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.3b8bbf97f78f29f4c7603ca4fa26689d.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoverview-li><a href=/docs/overview/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsoverview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsuser_manual-li><a href=/docs/user_manual/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsuser_manual><span>User manual</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualconcepts-li><a href=/docs/user_manual/concepts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualconcepts><span>Concepts</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualappstream_basics-li><a href=/docs/user_manual/appstream_basics/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualappstream_basics><span>AppStream Basics</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-docsuser_manualtutorials-li><a href=/docs/user_manual/tutorials/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsuser_manualtutorials><span>Tutorials</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualtutorialslogging-in-li><a href=/docs/user_manual/tutorials/logging-in/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualtutorialslogging-in><span>Logging in</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualtutorialsviewing-images-li><a href=/docs/user_manual/tutorials/viewing-images/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualtutorialsviewing-images><span>Viewing images</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualtutorialstracing-neurons-li><a href=/docs/user_manual/tutorials/tracing-neurons/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualtutorialstracing-neurons><span>Tracing neurons</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualtutorialsimport-export-li><a href=/docs/user_manual/tutorials/import-export/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualtutorialsimport-export><span>Exporting and importing neurons</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualbasic_operations-li><a href=/docs/user_manual/basic_operations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualbasic_operations><span>Basic Operations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualfeatures-li><a href=/docs/user_manual/features/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualfeatures><span>Features</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualreference-li><a href=/docs/user_manual/reference/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualreference><span>Reference</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualsynchronized_folders-li><a href=/docs/user_manual/synchronized_folders/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualsynchronized_folders><span>Synchronized Folders</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsuser_manualissues-li><a href=/docs/user_manual/issues/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsuser_manualissues><span>Reporting issues</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsadministration-li><a href=/docs/administration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsadministration><span>Administration guide</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsadministrationaws-li><a href=/docs/administration/aws/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsadministrationaws><span>AWS</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsadministrationawscosts-li><a href=/docs/administration/aws/costs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationawscosts><span>Costs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsadministrationawsdeployment-li><a href=/docs/administration/aws/deployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationawsdeployment><span>Deployment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsadministrationawsbackups-li><a href=/docs/administration/aws/backups/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationawsbackups><span>Backup & Restore</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsadministrationawsupgrading-li><a href=/docs/administration/aws/upgrading/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationawsupgrading><span>Upgrading</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsadministrationawsdata-li><a href=/docs/administration/aws/data/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationawsdata><span>Data Import</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsadministrationawstroubleshooting-li><a href=/docs/administration/aws/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationawstroubleshooting><span>Troubleshooting</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsadministrationbare_metal-li><a href=/docs/administration/bare_metal/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsadministrationbare_metal><span>Bare metal</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsadministrationbare_metaltwoserverdeployment-li><a href=/docs/administration/bare_metal/twoserverdeployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationbare_metaltwoserverdeployment><span>Two-server deployment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsadministrationbare_metalfulldeployment-li><a href=/docs/administration/bare_metal/fulldeployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationbare_metalfulldeployment><span>Three-server deployment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsadministrationbare_metalinstallingdocker-li><a href=/docs/administration/bare_metal/installingdocker/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationbare_metalinstallingdocker><span>Installing Docker</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsadministrationbare_metalswarmdeployment-li><a href=/docs/administration/bare_metal/swarmdeployment/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-docsadministrationbare_metalswarmdeployment><span class=td-sidebar-nav-active-item>Deploying JACS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsadministrationbare_metalelkdeployment-li><a href=/docs/administration/bare_metal/elkdeployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationbare_metalelkdeployment><span>Deploying ELK</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsadministrationbare_metalselfsignedcerts-li><a href=/docs/administration/bare_metal/selfsignedcerts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationbare_metalselfsignedcerts><span>Self-signed Certificates</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsadministrationbare_metalstoragevolumes-li><a href=/docs/administration/bare_metal/storagevolumes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationbare_metalstoragevolumes><span>Storage volumes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsadministrationbare_metaldataimport-li><a href=/docs/administration/bare_metal/dataimport/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationbare_metaldataimport><span>Data import</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsadministrationbare_metaltroubleshooting-li><a href=/docs/administration/bare_metal/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsadministrationbare_metaltroubleshooting><span>Troubleshooting</span></a></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsdevelopment-li><a href=/docs/development/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsdevelopment><span>Developer's guide</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdevelopmentgettingstarted-li><a href=/docs/development/gettingstarted/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdevelopmentgettingstarted><span>Getting started</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdevelopmentcomposedeployment-li><a href=/docs/development/composedeployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdevelopmentcomposedeployment><span>Single server deployment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-docsdevelopmentsystemoverview-li><a href=/docs/development/systemoverview/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsdevelopmentsystemoverview><span>System Overview</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdevelopmentsystemoverviewpersistence-li><a href=/docs/development/systemoverview/persistence/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdevelopmentsystemoverviewpersistence><span>Persistence</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdevelopmentsystemoverviewtileimagery-li><a href=/docs/development/systemoverview/tileimagery/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdevelopmentsystemoverviewtileimagery><span>Tiled Imagery</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdevelopmentsystemovervieweventhandling-li><a href=/docs/development/systemoverview/eventhandling/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdevelopmentsystemovervieweventhandling><span>Event Handling/Communication</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdevelopmentcontributing-li><a href=/docs/development/contributing/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdevelopmentcontributing><span>Contribution guidelines</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontribution-guidelines-li><a href=/docs/contribution-guidelines/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docscontribution-guidelines><span>Editing the documentation</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/JaneliaSciComp/hortacloud-website/tree/main/content/docs/administration/bare_metal/SwarmDeployment.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/JaneliaSciComp/hortacloud-website/edit/main/content/docs/administration/bare_metal/SwarmDeployment.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/JaneliaSciComp/hortacloud-website/new/main/content/docs/administration/bare_metal?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/JaneliaSciComp/hortacloud-website/issues/new?title=Deploying%20JACS" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/JaneliaSciComp/hortacloud/issues/new class="td-page-meta--project td-page-meta__project-issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
<a id=print href=/docs/administration/bare_metal/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#initialize-filesystems>Initialize Filesystems</a><ul><li><a href=#ssl-certificates>SSL Certificates</a></li><li><a href=#external-authentication>External Authentication</a></li></ul></li><li><a href=#start-all-containers>Start All Containers</a></li><li><a href=#initialize-databases>Initialize Databases</a></li><li><a href=#restart-services>Restart Services</a></li><li><a href=#verify-functionality>Verify Functionality</a></li><li><a href=#manage-services>Manage Services</a></li><li><a href=#configure-crontabs>Configure Crontabs</a></li><li><a href=#install-the-workstation-client>Install The Workstation Client</a></li><li><a href=#optional-adding-nfs-storage>Optional: Adding NFS Storage</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/administration/>Administration guide</a></li><li class=breadcrumb-item><a href=/docs/administration/bare_metal/>Bare metal</a></li><li class="breadcrumb-item active" aria-current=page>Deploying JACS</li></ol></nav><div class=td-content><h1>Deploying JACS</h1><div class=lead>Deploying the JACS services using Docker Swarm</div><header class=article-meta></header><p>This document assumes that you have downloaded and configured the installer according to one of the deployment guides.</p><p>The following steps are common to all Docker Swarm deployments of the Workstation.</p><h2 id=initialize-filesystems>Initialize Filesystems</h2><p>The first step is to initialize the filesystems on all your Swarm systems. On each server, ensure that your <code>REDUNDANT_STORAGE</code> (default: /opt/jacs), <code>NON_REDUNDANT_STORAGE</code> (default: /data) directories exist and can be written to by your UNAME:GNAME user (default: docker-nobody).</p><p>Then, run the Swarm-based initialization procedure from <strong>HOST1</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh init-filesystems
</span></span></code></pre></div><p>You can manually edit the files found in <code>CONFIG_DIR</code> to further customize the installation.</p><p>Once the initialization completes you can just run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh stop
</span></span></code></pre></div><p>Also it is a good idea to stop the initialization stack if anything goes wrong before you try it again.</p><h3 id=ssl-certificates>SSL Certificates</h3><p>At this point, <strong>it is strongly recommended is to replace the self-signed certificates</strong> in <code>$CONFIG_DIR/certs/*</code> on each server with your own certificates signed by a Certificate Authority:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>. .env
</span></span><span style=display:flex><span>sudo cp /path/to/your/certs/cert.<span style=color:#ce5c00;font-weight:700>{</span>crt,key<span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#000>$CONFIG_DIR</span>/certs/
</span></span><span style=display:flex><span>sudo chown docker-nobody:docker-nobody <span style=color:#000>$CONFIG_DIR</span>/certs/*
</span></span></code></pre></div><p>If you continue with the self-signed certificates, you will need to <a href=../selfsignedcerts>set up the trust chain</a> for them later.</p><h3 id=external-authentication>External Authentication</h3><p>The JACS system has its own self-contained authentication system, and can manage users and passwords internally.</p><p>If you&rsquo;d prefer that users authenticate against your existing LDAP or ActiveDirectory server, edit <code>$CONFIG_DIR/jacs-sync/jacs.properties</code> and add these properties:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#c4a000>LDAP.URL</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>LDAP.SearchBase</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>LDAP.SearchFilter</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>LDAP.BindDN</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>LDAP.BindCredentials</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span></code></pre></div><p>The URL should point to your authentication server. The SearchBase is part of a distinguished name to search, something like &ldquo;ou=People,dc=yourorg,dc=org&rdquo;. The SearchFilter is the attribute to search on, something like &ldquo;(cn={{username}})&rdquo;. BindDN and BindCredentials defines the distinguished name and password for a service user that can access user information like full names and emails.</p><h2 id=start-all-containers>Start All Containers</h2><p>Next, start up all of the service containers. The parameter to the start command specifies the environment to use. The <strong>dev</strong> environment uses containers tagged as <em>latest</em> and updates them automatically when they change. The <strong>prod</strong> deployment uses a frozen set of production versions. When in doubt, use the <strong>prod</strong> deployment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh start
</span></span></code></pre></div><p>It may take a minute for the containers to spin up. You can monitor the progress with this command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh status
</span></span></code></pre></div><p>At this stage, some of the services may not start because they depend on the databases. The next step will take care of that.</p><h2 id=initialize-databases>Initialize Databases</h2><p>Now you are ready to initalize the databases:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh init-databases
</span></span></code></pre></div><p>It&rsquo;s normal to see the &ldquo;Unable to reach primary for set rsJacs&rdquo; error repeated until the Mongo replica set converges on healthiness. After a few seconds, you should see a message &ldquo;Databases have been initialized&rdquo; and the process will exit successfully.</p><p>You can validate the databases as follows:</p><ul><li>Verify that you can connect to the Mongo instance using <code>./manage.sh mongo</code>, and run <code>show tables</code></li><li>Connect to the RabbitMQ server at http://<strong>HOST1</strong>:15672 and log in with your <code>RABBITMQ_USER</code>/<code>RABBITMQ_PASSWORD</code></li></ul><h2 id=restart-services>Restart Services</h2><p>Bounce the stack so that everything reconnects to the databases:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh stop
</span></span><span style=display:flex><span>./manage.sh start
</span></span></code></pre></div><p>Now you shoult wait for all the services to start. You can continue to monitor the progress with this command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh status
</span></span></code></pre></div><p>If any container failed to start up, it will show up with &ldquo;0/N&rdquo; replicas, and it will need to be investigated before moving further. You can view the corresponding error by specifying the swarm service name, as reported by the status command. For example, if jacs_jade-agent2 fails to start, you would type:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh status jacs_jade-agent2
</span></span></code></pre></div><h2 id=verify-functionality>Verify Functionality</h2><p>You can verify the Authentication Service is working as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh login
</span></span></code></pre></div><p>You should be able to log in with the default admin account (root/root), or any LDAP/AD account if you&rsquo;ve configured external authentication. This will return a JWT that can be used on subsequent requests.</p><p>If you run into any problems, these <a href=../troubleshooting>troubleshooting tips</a> may help.</p><h2 id=manage-services>Manage Services</h2><p>As long as your Docker daemon is configured to restart on boot, all of the Swarm services will also restart automatically when the server is rebooted.</p><p>If you want to remove all the services from the Swarm and do a clean restart of everything, you can use this command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh stop
</span></span></code></pre></div><p>To pull and redeploy the latest image for a single service, e.g. workstation-site:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh restart jacs_workstation-site
</span></span></code></pre></div><h2 id=configure-crontabs>Configure Crontabs</h2><p>The following crontab entries should be configured in order to perform periodic maintenance automatically. It&rsquo;s easiest to install the crontabs on the docker-nobody account:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo crontab -u docker-nobody -e
</span></span></code></pre></div><p>Database maintenance refreshes indexes and updates entities permissions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>2</span> * * * /opt/deploy/jacs-cm/manage.sh dbMaintenance group:admin -refreshIndexes -refreshPermissions
</span></span></code></pre></div><p>SOLR index refresh (if using SOLR):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>3</span> * * * /opt/deploy/jacs-cm/manage.sh rebuildSolrIndex
</span></span></code></pre></div><p>Database backups (if using containerized databases):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>4</span> * * * /opt/deploy/jacs-cm/manage.sh backup mongo
</span></span></code></pre></div><h2 id=install-the-workstation-client>Install The Workstation Client</h2><p>Now that the services are all running, you can navigate to <a href=https://HOST1>https://HOST1</a> in a web browser on your client machine, and download the Workstation client. Follow the installer wizard, using the default options, then launch the Workstation.</p><p>If you are using the default self-signed certificate, you will need to take some extra steps to <a href=../selfsignedcerts>install it on the client</a>.</p><p>If you are using LDAP/AD integration, you should be able to log in with your normal user/password. If you are using the Workstation&rsquo;s internal user management, you must first login as user root (password: root), and then select <strong>Window</strong> → <strong>Core</strong> → <strong>Administrative GUI</strong> from the menus. Click &ldquo;View Users&rdquo;, then &ldquo;New User&rdquo; and create your first user. Add the user to all of the relevant groups, including MouseLight.</p><h2 id=optional-adding-nfs-storage>Optional: Adding NFS Storage</h2><p>If you have data on NFS, and those NFS drives can be mounted on the MouseLight hosts, that data can be made available to the Workstation.</p><p>First, create a file at deployments/mouselight/docker-swarm.prod.yml which looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;3.7&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>jade-agent1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>/path/to/your/nfs:/path/to/your/nfs:ro,shared</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>jade-agent2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>/path/to/your/nfs:/path/to/your/nfs:ro,shared</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This will expose the path to both JADE agent containers. Now you need to configure the JADE agents to serve this data. On both hosts, edit /opt/jacs/config/jade/config.properties and add the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.RootDir</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/path/to/your/nfs</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.VirtualPath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/path/to/your/nfs</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.Shared</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>true</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.Tags</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>mousebrain,light</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.VolumePermissions</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>READ</span>
</span></span></code></pre></div><p>You can use any name you want instead of mouseLightNFS. Then you should add this name to StorageAgent.BootstrappedVolumes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#c4a000>StorageAgent.BootstrappedVolumes</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>jade1,mouseLightNFS</span>
</span></span></code></pre></div><p>You will need to bounce the service stack to pick up these changes.</p><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/JaneliaSciComp/hortacloud-website/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/JaneliaSciComp/hortacloud-website/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof gtag!="function")return;gtag("event","page_helpful",{event_category:"Helpful",event_label:window.location.pathname,value:e})};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(100)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class=td-page-meta__lastmod>Last modified May 10, 2022: <a href=https://github.com/JaneliaSciComp/hortacloud-website/commit/aaf56b6b2f09a45f5118dedf1e89f25a07f189c0>added overview and cleaned up other pages (aaf56b6)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email us" aria-label="Email us"><a target=_blank rel=noopener href=mailto:hortacloud@janelia.hhmi.org aria-label="Email us"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Twitter aria-label=Twitter><a target=_blank rel=noopener href=https://twitter.com/HortaCloud aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Project management board" aria-label="Project management board"><a target=_blank rel=noopener href=https://github.com/orgs/JaneliaSciComp/projects/3 aria-label="Project management board"><i class="fas fa-tasks"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/JaneliaSciComp/hortacloud aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>Howard Hughes Medical Institute</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://www.hhmi.org/privacy-policy target=_blank rel=noopener>Privacy Policy & Cookie Notice</a></span></div></div></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>