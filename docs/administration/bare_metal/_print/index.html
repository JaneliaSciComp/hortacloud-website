<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://hortacloud.janelia.org/docs/administration/bare_metal/><link rel=alternate type=application/rss+xml href=https://hortacloud.janelia.org/docs/administration/bare_metal/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Bare metal | HortaCloud</title>
<meta name=description content="Learn how to deploy a Horta instance on your own servers
"><meta property="og:url" content="https://hortacloud.janelia.org/docs/administration/bare_metal/"><meta property="og:site_name" content="HortaCloud"><meta property="og:title" content="Bare metal"><meta property="og:description" content="Learn how to deploy a Horta instance on your own servers"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://hortacloud.janelia.org/hortacloud_logo.png"><meta itemprop=name content="Bare metal"><meta itemprop=description content="Learn how to deploy a Horta instance on your own servers"><meta itemprop=dateModified content="2024-11-26T15:15:47-05:00"><meta itemprop=wordCount content="85"><meta itemprop=image content="https://hortacloud.janelia.org/hortacloud_logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://hortacloud.janelia.org/hortacloud_logo.png"><meta name=twitter:title content="Bare metal"><meta name=twitter:description content="Learn how to deploy a Horta instance on your own servers"><link rel=preload href=/scss/main.min.2ab329d78ff7a03cf1112551534b9f2d1f8a9e45bdc7f6ae359cf98066d0f241.css as=style><link href=/scss/main.min.2ab329d78ff7a03cf1112551534b9f2d1f8a9e45bdc7f6ae359cf98066d0f241.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-00000000-0")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 128 79"><defs><style>.cls-1{clip-path:url(#clippath)}.cls-2{fill:none}.cls-2,.cls-3,.cls-4,.cls-5,.cls-6{stroke-width:0}.cls-3{fill:url(#linear-gradient)}.cls-4{fill:url(#radial-gradient)}.cls-5{fill:url(#radial-gradient-2)}.cls-6{fill:url(#radial-gradient-3)}.cls-7{filter:url(#outer-glow-2)}</style><filter id="outer-glow-2" filterUnits="userSpaceOnUse"><feOffset dx="0" dy="0"/><feGaussianBlur result="blur" stdDeviation="2"/><feFlood flood-color="#7171ff" flood-opacity=".7"/><feComposite in2="blur" operator="in"/><feComposite in="SourceGraphic"/></filter><linearGradient id="linear-gradient" x1="63.48" y1="906.14" x2="63.48" y2="1020.06" gradientTransform="translate(0 1002) scale(1 -1)" gradientUnits="userSpaceOnUse"><stop offset=".13" stop-color="#32103d"/><stop offset=".16" stop-color="#341a43"/><stop offset=".22" stop-color="#38294c"/><stop offset=".29" stop-color="#3b3252"/><stop offset=".41" stop-color="#3c3554"/><stop offset=".56" stop-color="#3d3a62"/><stop offset=".85" stop-color="#404788"/></linearGradient><clipPath id="clippath"><path class="cls-2" d="M21.28 75c-9.45-.2-15.87-5.95-17.86-13.89-4.44-16.48 7.77-33.29 24.81-31.74 3.97.99 3.55-2.9 3.97-3.97C37.31 11.77 48.95 3.58 62.95 3.58c10.84.0 20.68 5.95 26.78 14.88 1.98 1.98.99 1.98 2.98.99 16.78-5.18 32.04 9.85 31.74 28.77.25 14.48-8.82 26.82-21.82 26.78H21.28z"/></clipPath><radialGradient id="radial-gradient" cx="23.68" cy="46.16" fx="23.68" fy="46.16" r="31.87" gradientTransform="translate(1.75 5.33) scale(1 .99)" gradientUnits="userSpaceOnUse"><stop offset=".04" stop-color="#4ac6b0"/><stop offset=".24" stop-color="#33ac9c"/><stop offset=".46" stop-color="#1f968b"/><stop offset=".58" stop-color="#2c6f7f" stop-opacity=".7"/><stop offset=".73" stop-color="#3b4472" stop-opacity=".38"/><stop offset=".84" stop-color="#442a6a" stop-opacity=".18"/><stop offset=".9" stop-color="#482067" stop-opacity=".1"/></radialGradient><radialGradient id="radial-gradient-2" cx="108.45" cy="46.89" fx="108.45" fy="46.89" r="27.33" gradientTransform="translate(-5.74) scale(.99 1)" gradientUnits="userSpaceOnUse"><stop offset=".04" stop-color="#95d840"/><stop offset=".12" stop-color="#84d34a"/><stop offset=".27" stop-color="#6acc59"/><stop offset=".41" stop-color="#5ac763"/><stop offset=".52" stop-color="#55c667"/><stop offset=".59" stop-color="#52b86a" stop-opacity=".9"/><stop offset=".73" stop-color="#4c9473" stop-opacity=".65"/><stop offset=".93" stop-color="#435b82" stop-opacity=".25"/><stop offset="1" stop-color="#404788" stop-opacity=".1"/></radialGradient><radialGradient id="radial-gradient-3" cx="65.31" cy="41.69" fx="65.31" fy="41.69" r="58.3" gradientTransform="translate(0 2.35)" gradientUnits="userSpaceOnUse"><stop offset=".09" stop-color="#fde735"/><stop offset=".12" stop-color="#f2dc37"/><stop offset=".22" stop-color="#d7bf3f"/><stop offset=".32" stop-color="#c4aa45"/><stop offset=".42" stop-color="#b89e48"/><stop offset=".52" stop-color="#b59a4a"/><stop offset=".56" stop-color="#a4874e" stop-opacity=".86"/><stop offset=".67" stop-color="#836257" stop-opacity=".59"/><stop offset=".76" stop-color="#69455e" stop-opacity=".38"/><stop offset=".85" stop-color="#573162" stop-opacity=".23"/><stop offset=".92" stop-color="#4b2465" stop-opacity=".13"/><stop offset=".97" stop-color="#482067" stop-opacity=".1"/></radialGradient></defs><g class="cls-7"><g><path class="cls-3" d="M21.28 75c-9.45-.2-15.87-5.95-17.86-13.89-4.44-16.48 7.77-33.29 24.81-31.74 3.97.99 3.55-2.9 3.97-3.97C37.31 11.77 48.95 3.58 62.95 3.58c10.84.0 20.68 5.95 26.78 14.88 1.98 1.98.99 1.98 2.98.99 16.78-5.18 32.04 9.85 31.74 28.77.25 14.48-8.82 26.82-21.82 26.78H21.28z"/><g class="cls-1"><path class="cls-4" d="M39.08 36.61c0-1.65 2.22-2.26 3.23-3.47 3.62-4 11.74-5.31 7.32-11.24-2.27 5.67-22.99 23.77-15.16 7.08 1.69-2.97 1.91-8.54 5.76-9.5-1.27-.62-1.77-3.62-2.91-3.8-1.39 9.89-8.08 18.73-10.61 28.41-3.31-7.14-3.08-9.75 3.83-12.99-.23-1.93-7.47 5.84-3.92-3.97-5.4 2.6-3.12 12.58-.97 18.88 5.12 14.96-16.81-2.97-15.98-12.65-4.17 1.26-3.42 12.04-5.35 6.42-1.13 1.89-2.02 3.91-2.66 6.04 3.45.57 6.76 3.78 8.63 6.49 3.16-.45 2.39 8.88.09 3.18-.12-.86-.61-2.4-.54-.43.32 3.41-4 7.52-7.53 7.5.45 1.21 1.01 2.39 1.66 3.51 2.13-2.81 4.5-.47 7.39-.43 3.09 1.3-1.61 7.26 1.1 8.3-.1-9.47 5.07-9.38 2.55-10.17-1.58-.6.51-1.95 1-2.6 8.23-3.73 2.73 10.98-.14 13.95 3.05.45 3.69-5.2 3.24.53 3.52-.91 1.07-9.42 2.92-13-1.13-9.67 9.76-7.18 15.82-5.23 4.63.41 8.41.06 11.62 2.51.62.49 1.18 1.08 1.64 1.75 3.71 4.57 3.35 9.01.6 14.03 9.71-7.41-4.77-19.21.65-16.37 4.19 3.12 9.85-.22 14.32 2.15 4.31 4.67 8.37 9.84 10.05 15.22.8-2.57 2.07-1.42 3.29-1.62-4.75-3.64-8.63-9.2-12.28-13.96-5.62-3.65-25.92-.82-9.47-8.28 7.04-3.33 11.63 6.64 10.8 1.91-4.11-9.5-13.3-1.38-19.97.35-5.52 2.06-16.2-2.71-8.62-8.4 4-3 4.17-5.94 9.14-4.7 2.74.4 5.76-2.28 8.68-1.16-.79-2.98-15.7 1.61-10.1-4.2-.35-.29-.66-.78-.84-1.24-.03.02-.06.05-.09.08-3.02 3.91-4.59 4.4-8.2 1.12zm4.42 5.11C41.86 44.71 34.88 52 30.69 52c-.22-3.14 2.1-3.25 4.29-2.71-.6-4.14-1.62-6.05 2.02-10.22 2.19-1.79 4.93 2.53 6.49 2.65zm-13 6.49c-2.65 3.61-.78-5.83.27-7.27.99-4.05 5.46-3.81 3.92-1.47.0.0-4.19 8.73-4.18 8.74zM7.68 40.34c-.81-7.97 3.82 4.37 4.02 6.94.26 3.3-3.83-3.96-4.02-6.94zM6.39 45.27c-.29-2.18 1.79 1.49 1.94 2.13-.85.11-1.72-1.27-1.94-2.13zm6.68 9.44c-1.6-3.96 7.74.52 3.71 2.54-2.26 2.17-3.49-.44-3.71-2.54zM11.5 64.3c-5.52-.18-2.8-2.82.37-3.05.8.68 1.27 3.4-.37 3.05zm1.01-4.59c-.42-2.01 2.47-.15 1.23 1.04-.66.24-1.03-.44-1.23-1.04zM20 57.92c-6.38 1.71 2.24-4.72 1.61-1.88-.08 1-.33 1.96-1.61 1.88zm17.77-3.25c-.82.35-10.45-1.5-4.75-2.02 2.55-1.97 5.4-2.07 4.75 2.02z"/><path class="cls-5" d="M118 50.29c-.13.0 2.29-.14 1.38-.09 2.04-.11 4.09-.2 6.09.18.04-.82.05-1.66.03-2.49-1.45-.36-6.51 1.44-5.5-.89 2.25-5.9-2.13-4.56 4.94-4.52-.1-.54-.21-1.07-.34-1.59-4.17.37-2.95-1.14-1.02-3.45-.24-.69-.52-1.37-.81-2.04-3.52 8.77-12.06-.08-19.88 5.76 1.3-3.89 9.12-13.26 13.19-15.55-1.03-1.02-2.13-1.95-3.29-2.81-1.25 3.94-4.85 6.69-7.28 9.84-2.63 3.29-8.74 15.1-13.48 9.18-2.04-2.84-5.08-4.94-7.15-7.82-1.49-1.78-3.02-3.65-4.57-5.02-.27.37-.55.73-.85 1.07 6.54 6.95-2.67-.13-5.14 2.84 5.99 1.39 13.69 4.58 16.01 10.5-.64 1.92-3.86 3.5-5.45 1.99-.07-.75 1.69-2.45-.37-1.85-2.28 1.51-3.8-2.3-5.34-3.37-1.7-1.57-5.25-2.76-7.13-4.43-.47.24-1.47.67-1.99.91.29.29.65.57 1.07.84 2.76 2.08 12.52 4.23 9.86 8.93-2.01 1.66-2.24 5.79-5.69 4.52-5.25-.49-6.68 1.57-11.83-.29l-.72 1.38c.64.19 2.42 1.08 3.96 1.17 2.48.3 9.1-2.45 6.68 2.44-3.13 5.99-10.75 11.92-10.75 11.92l.1 1.33s6.17-3.43 8.77-7.79c3.29-3.31 5.37-9.82 11.25-7.61 3.49.24 4.86-4.71 8.59-3.73 2.73 2.02-3.88 9.22-4.02 10.62-.24 11.82-8.57 8.95-14.33 15.63h1.67c2.24-2.62 4.21-1.96 8.07-3.25 4.84-6.5 5.36-1.01 2.01 3.25 1.68-.18 3.74-.03 5.52.0.35-1.67 2.07-1.7.13-4.2-1.46-1.42-.38-5.11 1.23-1.73 1.08 2.25 1.22 4.25 2.79 6.93h1.63c-5.73-7.01 1.76-5.76.4.0h2.03c.8-3.57-1.93-6.05-2.93-8.33-.82-3.71-3.55-6.9-3.57-10.65.36-4.44 6.91-11.88 10.91-6.97 1.5 2.38 1.42 5.7 3.45 7.86 1.72 1.67 1.33 3.82 2.15 3.89 3.26-.66 4.33 5.93 5.43 4.46.46-1.24 2.99.09 4.25.66.47-.51.91-1.04 1.34-1.59-5.3-.84-14.32-5.63-4.83-7.91-1.3-.88-3.22.17-4.33.9-2.65 3.24-6.36-6.6-6.12-8.46 3.5 3.19 9.34 4.59 13.11 7.73 1.22 1.17 3.83 1.3 5.39 2.56.16-.35.33-.7.48-1.06-2.97-2.33-6.75-3.61-9.7-5.82-.14-2.32 1.67-4.37 4.51-3.99h0zM78.2 52.66c-1.37.94-.91-2.06.74-.5-.09.17-.54.35-.73.51h0zm7.48-3.74c-2.09 2.34-7.25 4-3.22-.71.92-1.95 4.69-2.01 3.22.71zM91.97 46.89c4.09-5 6.47 2.03-.23.22.07-.07.15-.14.22-.23h0zm-2.47 26c-3.77 4.24-2.02-4.9-.83-2.19.28.82.79 1.36.83 2.19zM91 59.34c6.91 17.02-3.98 7.87-.79-.68.3.12.79.68.79.68zm26-16.97c3.87.0 2.34 2.5.9 4.63h0c-1.49 4.08-6.15.98-7.79-1.37-.65-.59-.53-1.5-.92-2.14-.7-.39-.99.16-1.23.88-1.11 3.5-6.71-1.11-1.51-1.43 3.78-.52 5.83-1.27 10.55-.56h0zm-8 8.42c-1.28-.74-5-2.77-5-3.79.08-1.59 7.03 2.58 8.67 2.67 1.95.51.37 2.29-.81 2.57-1.34.31-1.53-1.01-2.86-1.47h0z"/><path class="cls-6" d="M112.79 21.37c-4.83 1.62-8.28 3.81-11.61 7.7-1.98.41-3.81 1.04-5.52 2.11-2.38.67-.38-.84.52-1.11 1.46-.85 2.44-2.27 3.5-3.55 1.29-1.29 2.82-2.27 4.25-3.42 1.8-1.51 4.43-1.6 6.3-3.04-.16-.07-1.86-.73-2.02-.79-2.44 1.94-4.68 3.72-3.11-.85-.33-.07-.67-.13-1-.18-1.18 4.44-5.38 7-8.18 10.39h0c-4.58 4.51-10.99 6.03-17.23 6.66-1.1.0-3.46.72-4.05-.22.59-1.11 2.52-1.33 3.61-1.96 1.68-.73 3.37-1.56 4.71-2.78 1.84-1.48 2.22-3.96 3.87-5.61 1.63-2.25 1.88-5.14 3.45-7.48-.03-.05-1.03-1.39-1.04-1.4-.21.34-.41.68-.63 1.03h0c-1.16 1.45-1.24 3.09-1.74 4.61-.41 1.37-1.51 2.45-2.18 3.72-1.22 2.01-2.41 4.14-4.24 5.67-2.15 1.17-2.2.35-1.29-1.6.56-2.33.72-3.34 1.94-5.07 1.11-2.2 1.5-4.71 2.82-6.82.73-1.13.34-2.59-.7-.51-.68 1.21-1.33 3.01-1.93 4.16-.22.82-.56 1.57-.67.59-.19-2.05.8-3.74.46-5.73-1.1-1.82-.25-7.5-.09-7.79-.05-.03-1.96-1.23-2.03-1.27-1.95 5.67 1.89 7.11.53 11.87.04 4.03-2.49 7.32-2.89 11.26-.12.39-.74 1.11-.84.45.61-2.02-.74-1.2-2.02-2.41-2.57-2.38-3.08-7.32-2.35-10.58.36-1.33 1-2.58 1.86-3.64.46-2.88 2.09-5.54 2.99-8.33-.16-.08-2.12-.89-2.27-.94-.45 2.04-.84 4.18-1.52 6.17-.45 2.25-2.2 3.94-2.36 6.26.02.66-.33 1.26-.55 1.88-1.43 2.92 1.39 5.75.93 8.75.2 1.92 1.12 3.29-1.08 4.7-1.3.97-2.84 2.16-4.54 2.28-.45-.61.65-2.82-1.03-.47h0c-2.03 3.69-5.64-.13-2.93-2.62 4.66-5.7 2.04-5.15 3.81-9.44h0c1.32-3.01 4.65-4.4 3.52-7.87.1-3.43 2.19-7.5 1.83-10.8l-1.12-.24c-.26 1.34-.48 2.64-.4 4.02-.04 2.21-1.32 4.17-1.6 6.34.15 1.48.95 2.64-.1 3.96-.65.67-1.7 1.64-2.19 2.4-1.55 1.32-2.42-6.26-1.96-7.23.67-3.39-.98-6.6-.28-10.04-.12.0-.93.03-1.06.04.34 1.94-.01 3.44-.17 5.43.46 1.76 1.03 3.6.52 5.41-.7 4.24-4.07 6.52-3.58 11.36 1.03 2.85.68 5.44-.27 8.24-.53 1.06.0 5.05-2 4.02-1.74-2.8.05-5.75.14-8.66.0-1.74-1.12-3.52-.56-5.24.73-1.75-.16-4.04 1.55-5.3 2.5-2.58.65-5.76-.47-.78-.59 1.19-1.38-.04-1.66-.89-.71-1.61-.28-3.35-.27-5.03-.18-2.62-.02-5.28 1.12-7.75-.12.03-1.36.35-1.42.37-1.1 2.86-1.52 4.53-.79 7.43-.66 2.96-.61 3.59.58 6.39.87 3.63-1.9 2.8-1.44 8.73.16 1.2-.63 1.36-1.29.68-.86-1.07-.16-2.15-1.51-3.31-.62-.72-.06-1.69-.03-2.53.25-2.08.0-4.22-.63-6.22h0c-.84-2.52-2.41-4.88-4.28-6.78-.25.17-.49.34-.75.52 1.66 1.3 2.32 3.37 3.45 5.08 2.47 3.68-.14 8.49 1.78 10.56.72 1.77 1.15 3.73 1.73 5.54 1.68 1.98 2.39 4.32 1.05 6.74-1.43 2.22-3.68-.36-5.51-.55-1.96-1.02-2.35-3.76-2.91-5.52-.35-1.9.58-2.01-.04-4.4-.4-1.57-1.43-3.01-1.74-4.62-1.59-2.91-3.31-1.95-4.85-6.19-.13.16-.66.83-.79.99 1.06 1.89 2.4 3.66 4.12 4.98.79 1.76 1.3 3.74 2.13 5.51.34 1.33-.42 2.68-.11 4.01.08 1.22 1.54 2.95 1.32 4.22-2.15-.1-4.23-1.41-5.5-3.11-.49-.93-.49-2.18-1.29-2.94-2.23-1.76-3.44-4.41-4.23-7.07-.08.14-.71 1.41-.7 1.41 1.19 2.29 2.19 4.72 4.07 6.56.72 2.75 2.26 4.41 4.72 5.36-6.78-.4-7.18-3.37-11.02-7.76-.37.25-.82.41-1.28.45 1.09 1.38 2.38 2.65 3.35 4.12-2.3 2.02-6.36-2.89-8.34-4.11-.15.01-3.42.55-3.45.56 2.98 1.57 5.69 3.35 8.73 4.75 1.53.82 3.65.4 4.99 1.66-9.2-.03-10.25.14-18.54-4.71-.14.07-2.75 1.52-3.12 1.76 1.43.82 2.94 1.01 4.45 1.64 1.03.78 2.18 1.35 3.4 1.77 4.12 1.58 8.52.46 12.76.91 4.44 1.05 9.24.18 13.48 2.03 2.02.78 3.98 1.75 6.03 2.38 1.71.54 3.77.86 4.96 2.3 1.32 4.68 6.4 4.02 3.83 9.74-1.79 1.8-4.73 2.03-6.29 4.17-1.39 1.73-3.38 2.69-5.09 4.04-1.41 1.2-2.53 2.82-4.1 3.82h0c-.06.04-.11.08-.17.11-2.58 1.01-5.57 1.25-8.26 2.08-2.06.03-4.31-.13-6.27.62-1.09.48-2.2 1.03-3.36 1.34-10.22 1.43-5.56 1.84-13.83 5.59.48.17 2.98.8 3.12.83 4.48-3.62 6.08-3.99 11.38-5.04 3.56-1.53 3.76-2.9 8.13-1.86 1.77-.47 3.55-.74 5.29-1.31 2.41-.89 4.13-.85 2.04 1.68h0c-1.31 1.82-3.39 4.37-3.45 6.19h2.58c-.2-4.82 6.06-7.69 8.28-12.13 1.27-1.97 3.45-2.82 5.14-4.38.97-.92 2.54-2.81 3.71-1.29.14 3.65 3.26 7.31 1.24 10.85-.69 1.71-.14 3.01-1.43 4.01h0c-1.71 1.19-3.55 2.03-4.33 2.94h2.42c.63.0 2.25-1.23 2.08.0h1.95c.19-1.48.5-1.97 2.47-4.07 1-3.33-.67-7.27 1.55-10.25 2.65-3.86 3.88-.24 5.64 2.23 1.45 2.83-2.34 10.21-3.63 13.09h2.69c1.49-3.59 2.99-6.91 4.01-10.35.21-3.24-1.9-4.69 4.14-3.09 2.12.94 3.29 2.92 5.73 3.46 4.45 1.14 8.73 3.1 12.97 4.88 2.9 1.34 5.4 3.44 8.37 4.62l3.13-.6c-2-2.97-6.03-2.52-8.95-4.17-2.25-.96-4.45-2.05-6.72-2.94h0c-1.2-.76-2.56-1.23-3.87-1.76-1.54-.65-2.81-1.66-4.55-1.6-1.79-.41-3.72-2.2-5.46-2.82-7.95-1.51-9.68-2.49-12.64-10.46-.49-2.57.47-4.99 3.33-6.79 1.21-1.27 1.5-3.34 2.36-4.89 1.25-3.14 9.97-2.69 13.22-3.7 5.08-.68 9.49-3.11 14.02-5.27 1.39-.41 2.87-.65 4-1.65 6.46-6.66 4.56-2.64 11.13-6.2-.16-.11-1.84-1.18-2.02-1.28v-.02zM62.94 22c.06-.23.31-.5.57-.48h0c.48.34-.62 1.16-.58.48h0zM61 18.07c.14-.29.21-.64.46-.87.44.33.21 1.16.49 1.62 1.51 3.62-3.59 1.59-.95-.76h0zm-1.8 7.6c.66-1.65-.38-1.75-.09-3.14.28-.42.76-2.44 1.45-1.79.94 1.15.04 2.32-.55 3.38-.39.54-.13 1.28-.53 1.77h0s-.03.04-.05.05h0c-.18.14-.23-.15-.22-.28h0zM60.1 30c.75-2.03.54-4.26 1.51-6.22.22-.47.89-1.09.85-.12.45 1.44.54 2.65-.6 3.82-.48.82-.7 1.76-1.2 2.57-.34.62-1.02 1.05-.55-.05h0zm-5.55 7.12c1 .88-1.07.76-.7.0.17-.6.43-.4.7.0zM54.69 29.11c.07.65-.03 2.1-.86 1.73-.19-.11-.28-.3-.27-.5.98-1.82.1-2 .58-3.77.11-.3-.07-1.03.23-.41.53.92.08 1.97.31 2.94zM71.66 28c.59.52 1.07 1.15 1.52 1.77.95.77-.11 1.93-1.13 1.75-.23-.08-.2-.33-.18-.53.12-1.09-.58-2.23-.53-3.25.11.08.21.17.3.25h0zM58.86 38.92c-1.33-.93 2.06-1.25 2.58-1.7 1.16-.5 2.55-.93 3.71-.22 1.55.4-1.24.7-1.63.99-1.61.62-2.88 2.02-4.65.94zM63.54 61c-.63 1.31-1.24-.76-1.38-1.32-.14-1.33-.52-3.59.29-4.71 1.45-1.79 3.12-.44 3.38 1.4-.29 1.69-1.69 3.01-2.3 4.62h0zM70.15 37c-.88.1-3.33.49-3.19-.91.61-.43 1.36-.64 1.96-1.09.41-.35.84-.8 1.43-.79.61.0.89.63 1.16 1.08.67 1.04-.45 1.59-1.37 1.7h0z"/></g></g></g></svg></span><span class=navbar-brand__name>HortaCloud</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about/><span>About</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/instances/><span>Instances</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class=nav-item><a class=nav-link href=/publications/><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/team/><span>Team</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.40fc6e1ab1f30d4a8a96f82aa69bb1ee.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/administration/bare_metal/>Return to the regular view of this page</a>.</p></div><h1 class=title>Bare metal</h1><div class=lead>Learn how to deploy a Horta instance on your own servers</div><ul><li>1: <a href=#pg-ad51fc64a31547dbb98cadc6e22fdf62>Two-server deployment</a></li><li>2: <a href=#pg-5a6700f837d490c2f8cce74416e4c5a0>Three-server deployment</a></li><li>3: <a href=#pg-52fa8f551b4259f2d27e1238963f5ab4>Installing Docker</a></li><li>4: <a href=#pg-8c5f034c618e5b4f6fbabf8e6e9865e1>Deploying JACS</a></li><li>5: <a href=#pg-a0d43dee0f682d26aeeced42f6f523b6>Deploying ELK</a></li><li>6: <a href=#pg-a8d56f9f9ba6cf350fea8d567173c3e0>Self-signed Certificates</a></li><li>7: <a href=#pg-92ef9d692f28e2663500b1b1f2e1e902>Storage volumes</a></li><li>8: <a href=#pg-7a8952308cdb3a7af0e8db8edef7117c>Data import</a></li><li>9: <a href=#pg-6d70c3f179823392b17699c06103fb1a>Troubleshooting</a></li></ul><div class=content><div class="alert alert-warning" role=alert><h4 class=alert-heading>Warning</h4>This deployment method is no longer supported as we are shifting our development resources to the cloud deployment. You are on your own!</div><p>The recommended way to deploy HortaCloud is to use <a href=aws>Amazon Web Services (AWS)</a>, but you can also deploy the Horta services locally on your own client/server machines.</p><p>Using Docker Swarm, you can choose to deploy on two or three servers. The primary benefit of using three servers is that the MongoDB cluster will have a complete replica set for high availability.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ad51fc64a31547dbb98cadc6e22fdf62>1 - Two-server deployment</h1><div class=lead>How to deploy Horta to a pair of servers</div><p>This document describes the canonical two-server Janelia Workstation deployment for supporting neuron tracing for the <a href=https://www.janelia.org/project-team/mouselight>MouseLight project</a> at the Janelia Research Campus and other research institutions. This deployment uses Docker Swarm to orchestrate prebuilt containers available on Docker Hub.</p><h2 id=deployment-diagram>Deployment Diagram</h2><a href=../TwoServerDeployment.png><img src=../TwoServerDeployment.png class="rounded mx-auto" style=max-width:700px alt="two-server deployment diagram"></a><h2 id=hardware-setup>Hardware Setup</h2><p>The JACS backend consists of several services which need to be deployed on server hardware. We have tested the following configuration:</p><ul><li>Two Dell PowerEdge R740XD Servers<ul><li>Each server has 40 cores (e.g. Intel Xeon Gold 6148 2.4G)</li><li>Each server has 192 GB of memory</li><li>The hard drives are configured as follows:<ul><li>2 x 200GB SSD in RAID1 - Operating system (/)</li><li>2 x 960GB SSD in RAID1 - Databases, user preferences, etc. (/opt)</li><li>12 x 10TB in RAID6 - Image files (/data)</li></ul></li></ul></li></ul><p>The rest of this guide assumes that you have two server hosts dedicated to deploying this system, which are configured as listed above. They will be referred to as <strong>HOST1</strong> and <strong>HOST2</strong>.</p><p>This two-server deployment can support 5-10 concurrent users. We use the following configuration for client machines:</p><ul><li>Dell Precision 5820 Tower<ul><li>Minimum of 8 cores (e.g. Intel Xeon W-2145 3.7GHz)</li><li>128 GB of memory</li><li>Nvidia GTX1080Ti 11GB (reference card, blower fan style)<ul><li>Other similar cards will work fine: GTX1070, GTX1080, RTX2080</li></ul></li><li>Windows 10</li></ul></li></ul><h2 id=install-oracle-linux-8>Install Oracle Linux 8</h2><p>The backend software runs on any operating system which supports Docker. However, Oracle Linux is used at Janelia and has been extensively tested with this software. Therefore, we recommend installing the latest version of Oracle Linux 8.</p><h2 id=install-docker>Install Docker</h2><p>To install Docker and Docker Compose on Oracle Linux 8, follow <a href=../installingdocker>these instructions</a>.</p><h2 id=setup-docker-swarm>Setup Docker Swarm</h2><p>On <strong>HOST1</strong>, bring up swarm as a manager node:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker swarm init
</span></span></code></pre></div><p>On <strong>HOST2</strong>, copy and paste the output of the previous command to join the swarm as a worker.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker swarm join --token ...
</span></span></code></pre></div><p>All further commands should be executed on <strong>HOST1</strong>, i.e. the master node. One final step is to label the nodes. Each node needs the &ldquo;jacs=true&rdquo; label, as well as &ldquo;jacs_name=nodeX&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs_name</span><span style=color:#ce5c00;font-weight:700>=</span>node1 <span style=color:#204a87;font-weight:700>$(</span>docker node ls -f <span style=color:#4e9a06>&#34;role=manager&#34;</span> --format <span style=color:#4e9a06>&#34;{{.ID}}&#34;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs_name</span><span style=color:#ce5c00;font-weight:700>=</span>node2 <span style=color:#204a87;font-weight:700>$(</span>docker node ls -f <span style=color:#4e9a06>&#34;role=worker&#34;</span> --format <span style=color:#4e9a06>&#34;{{.ID}}&#34;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#204a87;font-weight:700>$(</span>docker node ls -f <span style=color:#4e9a06>&#34;role=manager&#34;</span> --format <span style=color:#4e9a06>&#34;{{.ID}}&#34;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#204a87;font-weight:700>$(</span>docker node ls -f <span style=color:#4e9a06>&#34;role=worker&#34;</span> --format <span style=color:#4e9a06>&#34;{{.ID}}&#34;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>Finally, you can run this command to ensure that both nodes are up and in Ready status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker node ls
</span></span></code></pre></div><h2 id=download-the-installer>Download the installer</h2><p>Download the installer and extract it onto the master node, as follows. <code>VERSION</code> should be set to the <a href=https://github.com/JaneliaSciComp/jacs-cm/releases>latest stable version</a> available on the releases page.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;version_number_here&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> /opt
</span></span><span style=display:flex><span>sudo mkdir deploy
</span></span><span style=display:flex><span>sudo chown <span style=color:#000>$USER</span> deploy
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> deploy
</span></span><span style=display:flex><span>curl https://codeload.github.com/JaneliaSciComp/jacs-cm/tar.gz/<span style=color:#000>$VERSION</span> <span style=color:#000;font-weight:700>|</span> tar xvz
</span></span><span style=display:flex><span>ln -s jacs-cm-<span style=color:#000>$VERSION</span> jacs-cm
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> jacs-cm
</span></span></code></pre></div><h2 id=configure-the-system>Configure The System</h2><p>Next, create a <code>.env.config</code> file inside the intaller directory. This file defines the environment (usernames, passwords, etc.) You can copy the template to get started:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp .env.template .env.config
</span></span><span style=display:flex><span>vi .env.config
</span></span></code></pre></div><p>At minimum, you must customize the following:</p><ol><li>Set <code>DEPLOYMENT</code> to <strong>mouselight</strong>.</li><li>Ensure that <code>REDUNDANT_STORAGE</code> and <code>NON_REDUNDANT_STORAGE</code> point to the disk mounts you used during the operating system installation. Alternatively, you can make symbolic links so that the default paths point to your mounted disks.</li><li>Set <code>HOST1</code> and <code>HOST2</code> to the two servers you are deploying on. Use fully-qualified hostnames here &ndash; they should match the SSL certificate you intend to use.</li><li>Fill in all the unset passwords with >8 character passwords. You should only use alphanumeric characters, special characters are not currently supported.</li><li>Generate 32-byte secret keys for JWT_SECRET_KEY, MONGODB_SECRET_KEY, JACS_API_KEY, and JADE_API_KEY.</li><li>If you want to enable automated error reporting from the Workstation client, set <code>MAIL_SERVER</code> to an SMTP server and port, e.g. smtp.my.org:25.</li></ol><h2 id=deploy-services>Deploy Services</h2><p>Now you can follow the <a href=../swarmdeployment>Swarm Deployment instructions</a> to actually deploy the software.</p><h2 id=import-imagery>Import Imagery</h2><p>If you have your own imagery, you will need to <a href=../dataimport>convert it</a> before importing.</p><p>Each brain image is referred to as a &ldquo;sample&rdquo;. You should place each sample in <code>$DATA_DIR/jacsstorage/samples</code> on one of the servers. If you place the sample on the first server, in <code>$DATA_DIR/jacsstorage/samples/&lt;sampleDirectoryName></code>, then in the Workstation you will refer to the sample as <code>/jade1/&lt;sampleDirectoryName></code>.</p><p>As a side note if you use &rsquo;lvDataImport&rsquo; service to generate the imagery, the service does not use JADE to persist the data. So if you need the data to be on a storage that is only accessible on certain hosts, JACS must run on that host in order to be able to write the data to the corresponding location. If that is not an option you can generate the data to a temporary location then move it to the intended sample directory.</p><p>In the Workstation, select <strong>File</strong> → <strong>New</strong> → <strong>Horta Sample</strong>, and then set &ldquo;Sample Name&rdquo; to <code>&lt;sampleDirectoryName></code> and &ldquo;Path to Render Folder&rdquo; as <code>/jade1/&lt;sampleDirectoryName></code>.</p><p>Open the Data Explorer (<strong>Window</strong> → <strong>Core</strong> → <strong>Data Explorer</strong>) and navigate to Home, then &ldquo;3D RawTile Microscope Samples&rdquo;, and your sample name. Right-click the sample and choose &ldquo;Open in Large Volume Viewer&rdquo;. The 2D imagery should load into the middle panel. You should be able to right-click anywhere on the image and select &ldquo;Navigate to This Location in Horta (channel 1)&rdquo;, to load the 3D imagery.</p><h2 id=find-more-information>Find More Information</h2><p>This concludes the MouseLight Workstation installation procedure. Further information on using the tools can be found in the <a href=../../../user_manual>User Manual</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-5a6700f837d490c2f8cce74416e4c5a0>2 - Three-server deployment</h1><div class=lead>How to deploy Horta to three servers</div><p>This document describes the full three-server Janelia Workstation deployment for supporting both FlyLight and MouseLight at Janelia Research Campus. This deployment uses Docker Swarm to orchestrate containers available on Docker Hub.</p><p>Multiple <em>environments</em> are supported with this deployment:</p><ul><li><strong>prod</strong></li><li><strong>dev</strong></li></ul><h2 id=deployment-diagram>Deployment Diagram</h2><a href=../FullDeployment.png><img src=../FullDeployment.png class="rounded mx-auto" style=max-width:700px alt="three-server deployment diagram"></a><h2 id=hardware-setup>Hardware Setup</h2><p>This guide assumes that you have three high-end servers which can be dedicated to running Docker Swarm. We use 40-core servers with at least 192 GB of RAM. YMMV.</p><p>We&rsquo;ll refer to the three deployment hosts as <strong>HOST1</strong>, <strong>HOST2</strong>, and <strong>HOST3</strong>.</p><p>Note that an additional server or VM is necessary to run the JACS Async Services outside of Docker, if you are planning to submit image processing jobs to an HPC cluster, such as with the Image Processing Pipeline (IPP).</p><h2 id=install-oracle-linux-8>Install Oracle Linux 8</h2><p>The backend software should run on any operating system which supports Docker. However, Oracle Linux is used at Janelia and has been extensively tested with this software. Therefore, we recommend installing the latest version of Oracle Linux 8. Previously, we used Scientific Linux 7 and that is also known well although it&rsquo;s no longer supported.</p><h2 id=install-docker>Install Docker</h2><p>To install Docker and Docker Compose on Oracle Linux 8, follow <a href=../installingdockerol8>these instructions</a>.</p><h2 id=setup-docker-swarm>Setup Docker Swarm</h2><p>On <strong>HOST1</strong>, bring up swarm as a manager node, and give it a label:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker swarm init
</span></span></code></pre></div><p>On <strong>HOST2</strong> and <strong>HOST3</strong>, copy and paste the output of the previous command to join the swarm as a worker.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker swarm join --token ...
</span></span></code></pre></div><p>All further commands should be executed on <strong>HOST1</strong>, i.e. the master node. One final step is to label the nodes. Each node needs the &ldquo;jacs=true&rdquo; label, as well as &ldquo;jacs_name=nodeX&rdquo;. You can find out the node ids by running <code>docker node ls</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs_name</span><span style=color:#ce5c00;font-weight:700>=</span>node1 &lt;id of HOST1&gt;
</span></span><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs_name</span><span style=color:#ce5c00;font-weight:700>=</span>node2 &lt;id of HOST2&gt;
</span></span><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs_name</span><span style=color:#ce5c00;font-weight:700>=</span>node3 &lt;id of HOST3&gt;
</span></span><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> &lt;id of HOST1&gt;
</span></span><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> &lt;id of HOST2&gt;
</span></span><span style=display:flex><span>docker node update --label-add <span style=color:#000>jacs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> &lt;id of HOST3&gt;
</span></span></code></pre></div><h2 id=download-the-installer>Download the installer</h2><p>Download the installer and extract it onto the master node, as follows. <code>VERSION</code> should be set to the <a href=https://github.com/JaneliaSciComp/jacs-cm/releases>latest stable version</a> available on the releases page.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;version_number_here&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> /opt
</span></span><span style=display:flex><span>sudo mkdir deploy
</span></span><span style=display:flex><span>sudo chown <span style=color:#000>$USER</span> deploy
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> deploy
</span></span><span style=display:flex><span>curl https://codeload.github.com/JaneliaSciComp/jacs-cm/tar.gz/<span style=color:#000>$VERSION</span> <span style=color:#000;font-weight:700>|</span> tar xvz
</span></span><span style=display:flex><span>ln -s jacs-cm-<span style=color:#000>$VERSION</span> jacs-cm
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> jacs-cm
</span></span></code></pre></div><h2 id=configure-the-system>Configure The System</h2><p>Next, create a <code>.env.config</code> file inside the installer directory. This file defines the environment (usernames, passwords, etc.) You can copy the template to get started:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp .env.template .env.config
</span></span><span style=display:flex><span>vi .env.config
</span></span></code></pre></div><p>At minimum, you must customize the following:</p><ol><li>Ensure that <code>REDUNDANT_STORAGE</code> and <code>NON_REDUNDANT_STORAGE</code> point to the disk mounts available on the local systems. Alternatively, you can make symbolic links so that the default paths point to your mounted disks.</li><li>Set <code>HOST1</code>, <code>HOST2</code>, and <code>HOST3</code> to the servers you are deploying on. Use fully-qualified hostnames here &ndash; they should match the SSL certificate you intend to use. Do not use localhost or the loopback address (<code>127.0.0.1</code>). If you don&rsquo;t have a DNS name for the hosts, use the host&rsquo;s IP address.</li><li>Fill in all the unset passwords with >8 character passwords. You should only use alphanumeric characters, special characters are not currently supported.</li><li>Generate 32-byte secret keys for JWT_SECRET_KEY, MONGODB_SECRET_KEY and JADE_API_KEY. If JADE_API_KEY is not set jacs-sync service will not be able to register any Mouselight samples.</li><li>Set <code>JADE_AGENT_VOLUMES</code> to the volumes that you want to be created when you start the system - typically <code>jade1,jade2</code>, but these really depend on the volumes that you you setup in your jade service configuration.</li></ol><h2 id=enable-databases-optional>Enable Databases (optional)</h2><p>Currently, Janelia runs MongoDB outside of the Swarm, so they are commented out in the deployment. If you&rsquo;d like to run the databases as part of the swarm, edit the yaml files under ./deployments/jacs/ and uncomment the databases.</p><h2 id=deploy-services>Deploy Services</h2><p>Now you can follow the <a href=../swarmdeployment>Swarm Deployment instructions</a> to actually deploy the software.</p><h2 id=deploy-elk-for-monitoring>Deploy ELK for monitoring</h2><p>To deploy an ELK stack for monitoring follow <a href=../elkdeployment>ELK Deployment</a>.</p><h2 id=find-more-information>Find More Information</h2><p>This concludes the MouseLight Workstation installation procedure. Further information on using the tools can be found in the <a href=../../../user_manual>User Manual</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-52fa8f551b4259f2d27e1238963f5ab4>3 - Installing Docker</h1><div class=lead>How to install Docker on Oracle Linux 8</div><p>To install Docker on a server running Oracle Linux 8, some special configuration is needed. Much of this comes from the <a href=https://docs.docker.com/install/linux/docker-ce/centos/>official documentation</a>.</p><h2 id=prerequisites>Prerequisites</h2><p>First, make sure that Docker isn’t already installed:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum list installed <span style=color:#000;font-weight:700>|</span> grep docker
</span></span></code></pre></div><p>Remove any existing installations before proceeding.</p><p>Ensure that /opt (or whatever disk is to be used for Docker data) is formatted with the d_type option. You can find out like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ xfs_info /opt
</span></span><span style=display:flex><span>meta-data<span style=color:#ce5c00;font-weight:700>=</span>/dev/mapper/vg0-lv_opt <span style=color:#000>isize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>512</span>    <span style=color:#000>agcount</span><span style=color:#ce5c00;font-weight:700>=</span>4, <span style=color:#000>agsize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>5701632</span> <span style=color:#000>blks</span>
</span></span><span style=display:flex><span>         <span style=color:#ce5c00;font-weight:700>=</span>                       <span style=color:#000>sectsz</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4096</span>  <span style=color:#000>attr</span><span style=color:#ce5c00;font-weight:700>=</span>2, <span style=color:#000>projid32bit</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>1</span>
</span></span><span style=display:flex><span>         <span style=color:#ce5c00;font-weight:700>=</span>                       <span style=color:#000>crc</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>        <span style=color:#000>finobt</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000>spinodes</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#000>data</span>     <span style=color:#ce5c00;font-weight:700>=</span>                       <span style=color:#000>bsize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4096</span>   <span style=color:#000>blocks</span><span style=color:#ce5c00;font-weight:700>=</span>22806528, <span style=color:#000>imaxpct</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>25</span>
</span></span><span style=display:flex><span>         <span style=color:#ce5c00;font-weight:700>=</span>                       <span style=color:#000>sunit</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>      <span style=color:#000>swidth</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> blks
</span></span><span style=display:flex><span><span style=color:#000>naming</span>   <span style=color:#ce5c00;font-weight:700>=</span>version <span style=color:#0000cf;font-weight:700>2</span>              <span style=color:#000>bsize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4096</span>   ascii-ci<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000>ftype</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#000>log</span>      <span style=color:#ce5c00;font-weight:700>=</span>internal               <span style=color:#000>bsize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4096</span>   <span style=color:#000>blocks</span><span style=color:#ce5c00;font-weight:700>=</span>11136, <span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>2</span>
</span></span><span style=display:flex><span>         <span style=color:#ce5c00;font-weight:700>=</span>                       <span style=color:#000>sectsz</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4096</span>  <span style=color:#000>sunit</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span> blks, lazy-count<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#000>realtime</span> <span style=color:#ce5c00;font-weight:700>=</span>none                   <span style=color:#000>extsz</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>4096</span>   <span style=color:#000>blocks</span><span style=color:#ce5c00;font-weight:700>=</span>0, <span style=color:#000>rtextents</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span>
</span></span></code></pre></div><p>If the above says ftype=0, then the filesystem will need to be recreated (<a href=https://linuxer.pro/2017/03/what-is-d_type-and-why-docker-overlayfs-need-it/>reference</a>).</p><h2 id=installing-docker>Installing Docker</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo yum install -y yum-utils
</span></span><span style=display:flex><span>sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
</span></span><span style=display:flex><span>sudo yum install -y docker-ce
</span></span></code></pre></div><p>If this fails with error messages like <code>package containerd.io-1.4.3-3.2.el8.x86_64 conflicts with runc provided by runc</code> then you may have conflicting packages installed already. Try removing them like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo yum erase podman buildah
</span></span></code></pre></div><h2 id=post-install-configuration>Post Install Configuration</h2><p>To avoid running out of space on the root partition, you should configure docker to point to /opt/docker (<a href=https://www.rb-associates.co.uk/blog/move-var-lib-docker-to-another-directory/>reference</a>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /opt/docker
</span></span><span style=display:flex><span>sudo chown root:root /opt/docker
</span></span><span style=display:flex><span>sudo chmod <span style=color:#0000cf;font-weight:700>701</span> /opt/docker
</span></span></code></pre></div><p>Next, configure Docker to use the overlay2 storage driver (<a href=https://www.projectatomic.io/blog/2015/06/notes-on-fedora-centos-and-docker-storage-drivers/>reference</a>).</p><p>Create a file at /etc/docker/daemon.json with this content:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;data-root&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/opt/docker&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;storage-driver&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;overlay2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>You should also create a local user called &ldquo;docker-nobody&rdquo; with UID 4444, which can be used for running containers without root.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo groupadd -g <span style=color:#0000cf;font-weight:700>4444</span> docker-nobody
</span></span><span style=display:flex><span>sudo useradd --uid <span style=color:#0000cf;font-weight:700>4444</span> --gid <span style=color:#0000cf;font-weight:700>4444</span> --shell /sbin/nologin docker-nobody
</span></span></code></pre></div><p>Finally, you can start Docker:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl <span style=color:#204a87>enable</span> docker
</span></span><span style=display:flex><span>sudo systemctl start docker
</span></span></code></pre></div><h2 id=installing-docker-compose>Installing Docker Compose</h2><p>You&rsquo;ll also need to install the Docker Compose executable:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo curl -L <span style=color:#4e9a06>&#34;https://github.com/docker/compose/releases/download/1.23.2/docker-compose-</span><span style=color:#204a87;font-weight:700>$(</span>uname -s<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>-</span><span style=color:#204a87;font-weight:700>$(</span>uname -m<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span> -o /usr/local/bin/docker-compose
</span></span><span style=display:flex><span>sudo chmod +x /usr/local/bin/docker-compose
</span></span></code></pre></div><p>Note that there are newer versions of the Docker Compose, but they have bugs that prevent them from working with our scripts. Please use the version above to ensure compatibility.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8c5f034c618e5b4f6fbabf8e6e9865e1>4 - Deploying JACS</h1><div class=lead>Deploying the JACS services using Docker Swarm</div><p>This document assumes that you have downloaded and configured the installer according to one of the deployment guides.</p><p>The following steps are common to all Docker Swarm deployments of the Workstation.</p><h2 id=initialize-filesystems>Initialize Filesystems</h2><p>The first step is to initialize the filesystems on all your Swarm systems. On each server, ensure that your <code>REDUNDANT_STORAGE</code> (default: /opt/jacs), <code>NON_REDUNDANT_STORAGE</code> (default: /data) directories exist and can be written to by your UNAME:GNAME user (default: docker-nobody).</p><p>Then, run the Swarm-based initialization procedure from <strong>HOST1</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh init-filesystems
</span></span></code></pre></div><p>You can manually edit the files found in <code>CONFIG_DIR</code> to further customize the installation.</p><p>Once the initialization completes you can just run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh stop
</span></span></code></pre></div><p>Also it is a good idea to stop the initialization stack if anything goes wrong before you try it again.</p><h3 id=ssl-certificates>SSL Certificates</h3><p>At this point, <strong>it is strongly recommended is to replace the self-signed certificates</strong> in <code>$CONFIG_DIR/certs/*</code> on each server with your own certificates signed by a Certificate Authority:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>. .env
</span></span><span style=display:flex><span>sudo cp /path/to/your/certs/cert.<span style=color:#ce5c00;font-weight:700>{</span>crt,key<span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#000>$CONFIG_DIR</span>/certs/
</span></span><span style=display:flex><span>sudo chown docker-nobody:docker-nobody <span style=color:#000>$CONFIG_DIR</span>/certs/*
</span></span></code></pre></div><p>If you continue with the self-signed certificates, you will need to <a href=../selfsignedcerts>set up the trust chain</a> for them later.</p><h3 id=external-authentication>External Authentication</h3><p>The JACS system has its own self-contained authentication system, and can manage users and passwords internally.</p><p>If you&rsquo;d prefer that users authenticate against your existing LDAP or ActiveDirectory server, edit <code>$CONFIG_DIR/jacs-sync/jacs.properties</code> and add these properties:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#c4a000>LDAP.URL</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>LDAP.SearchBase</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>LDAP.SearchFilter</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>LDAP.BindDN</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>LDAP.BindCredentials</span><span style=color:#ce5c00;font-weight:700>=</span>
</span></span></code></pre></div><p>The URL should point to your authentication server. The SearchBase is part of a distinguished name to search, something like &ldquo;ou=People,dc=yourorg,dc=org&rdquo;. The SearchFilter is the attribute to search on, something like &ldquo;(cn={{username}})&rdquo;. BindDN and BindCredentials defines the distinguished name and password for a service user that can access user information like full names and emails.</p><h2 id=start-all-containers>Start All Containers</h2><p>Next, start up all of the service containers. The parameter to the start command specifies the environment to use. The <strong>dev</strong> environment uses containers tagged as <em>latest</em> and updates them automatically when they change. The <strong>prod</strong> deployment uses a frozen set of production versions. When in doubt, use the <strong>prod</strong> deployment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh start
</span></span></code></pre></div><p>It may take a minute for the containers to spin up. You can monitor the progress with this command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh status
</span></span></code></pre></div><p>At this stage, some of the services may not start because they depend on the databases. The next step will take care of that.</p><h2 id=initialize-databases>Initialize Databases</h2><p>Now you are ready to initalize the databases:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh init-databases
</span></span></code></pre></div><p>It&rsquo;s normal to see the &ldquo;Unable to reach primary for set rsJacs&rdquo; error repeated until the Mongo replica set converges on healthiness. After a few seconds, you should see a message &ldquo;Databases have been initialized&rdquo; and the process will exit successfully.</p><p>You can validate the databases as follows:</p><ul><li>Verify that you can connect to the Mongo instance using <code>./manage.sh mongo</code>, and run <code>show tables</code></li><li>Connect to the RabbitMQ server at http://<strong>HOST1</strong>:15672 and log in with your <code>RABBITMQ_USER</code>/<code>RABBITMQ_PASSWORD</code></li></ul><h2 id=restart-services>Restart Services</h2><p>Bounce the stack so that everything reconnects to the databases:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh stop
</span></span><span style=display:flex><span>./manage.sh start
</span></span></code></pre></div><p>Now you shoult wait for all the services to start. You can continue to monitor the progress with this command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh status
</span></span></code></pre></div><p>If any container failed to start up, it will show up with &ldquo;0/N&rdquo; replicas, and it will need to be investigated before moving further. You can view the corresponding error by specifying the swarm service name, as reported by the status command. For example, if jacs_jade-agent2 fails to start, you would type:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh status jacs_jade-agent2
</span></span></code></pre></div><h2 id=verify-functionality>Verify Functionality</h2><p>You can verify the Authentication Service is working as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh login
</span></span></code></pre></div><p>You should be able to log in with the default admin account (root/root), or any LDAP/AD account if you&rsquo;ve configured external authentication. This will return a JWT that can be used on subsequent requests.</p><p>If you run into any problems, these <a href=../troubleshooting>troubleshooting tips</a> may help.</p><h2 id=manage-services>Manage Services</h2><p>As long as your Docker daemon is configured to restart on boot, all of the Swarm services will also restart automatically when the server is rebooted.</p><p>If you want to remove all the services from the Swarm and do a clean restart of everything, you can use this command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh stop
</span></span></code></pre></div><p>To pull and redeploy the latest image for a single service, e.g. workstation-site:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh restart jacs_workstation-site
</span></span></code></pre></div><h2 id=configure-crontabs>Configure Crontabs</h2><p>The following crontab entries should be configured in order to perform periodic maintenance automatically. It&rsquo;s easiest to install the crontabs on the docker-nobody account:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo crontab -u docker-nobody -e
</span></span></code></pre></div><p>Database maintenance refreshes indexes and updates entities permissions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>2</span> * * * /opt/deploy/jacs-cm/manage.sh dbMaintenance group:admin -refreshIndexes -refreshPermissions
</span></span></code></pre></div><p>SOLR index refresh (if using SOLR):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>3</span> * * * /opt/deploy/jacs-cm/manage.sh rebuildSolrIndex
</span></span></code></pre></div><p>Database backups (if using containerized databases):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>4</span> * * * /opt/deploy/jacs-cm/manage.sh backup mongo
</span></span></code></pre></div><h2 id=install-the-workstation-client>Install The Workstation Client</h2><p>Now that the services are all running, you can navigate to <a href=https://HOST1>https://HOST1</a> in a web browser on your client machine, and download the Workstation client. Follow the installer wizard, using the default options, then launch the Workstation.</p><p>If you are using the default self-signed certificate, you will need to take some extra steps to <a href=../selfsignedcerts>install it on the client</a>.</p><p>If you are using LDAP/AD integration, you should be able to log in with your normal user/password. If you are using the Workstation&rsquo;s internal user management, you must first login as user root (password: root), and then select <strong>Window</strong> → <strong>Core</strong> → <strong>Administrative GUI</strong> from the menus. Click &ldquo;View Users&rdquo;, then &ldquo;New User&rdquo; and create your first user. Add the user to all of the relevant groups, including MouseLight.</p><h2 id=optional-adding-nfs-storage>Optional: Adding NFS Storage</h2><p>If you have data on NFS, and those NFS drives can be mounted on the MouseLight hosts, that data can be made available to the Workstation.</p><p>First, create a file at deployments/mouselight/docker-swarm.prod.yml which looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;3.7&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>jade-agent1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>/path/to/your/nfs:/path/to/your/nfs:ro,shared</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>jade-agent2</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>/path/to/your/nfs:/path/to/your/nfs:ro,shared</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This will expose the path to both JADE agent containers. Now you need to configure the JADE agents to serve this data. On both hosts, edit /opt/jacs/config/jade/config.properties and add the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.RootDir</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/path/to/your/nfs</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.VirtualPath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/path/to/your/nfs</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.Shared</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>true</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.Tags</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>mousebrain,light</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>StorageVolume.mouseLightNFS.VolumePermissions</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>READ</span>
</span></span></code></pre></div><p>You can use any name you want instead of mouseLightNFS. Then you should add this name to StorageAgent.BootstrappedVolumes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#c4a000>StorageAgent.BootstrappedVolumes</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>jade1,mouseLightNFS</span>
</span></span></code></pre></div><p>You will need to bounce the service stack to pick up these changes.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a0d43dee0f682d26aeeced42f6f523b6>5 - Deploying ELK</h1><div class=lead>How to deploy ELK for log monitoring</div><p>Currently ELK is only available in a swarm deployment because of how the ELK stack is configured.</p><p>Most of the set up necessary for ELK - configuration files and/or data directories - is already done as part of filesystem initialization performed while executing:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh init-filesystems
</span></span></code></pre></div><p>The current ELK data directories are created on <code>/data/</code> directory so this directory must exist.</p><p>One manual step is to set the <code>vm.max_map_count</code> value required for running elasticsearch. This is done by adding <code>vm.max_map_count=262144</code> line to <code>/etc/sysctl.conf</code> and then run <code>sysctl -p</code> (typically this must be done as root)</p><p>After that deploying the elk stack for monitoring the application only requires starting with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh start-elk
</span></span></code></pre></div><p>The command to stop the monitoring is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh stop-elk
</span></span></code></pre></div><h2 id=import-data-from-an-old-stack>Import data from an old stack</h2><p>To import data from an old stack the old stack nodes must be whitelisted in the <code>ELK_WHITELIST</code> environment variable so that they can be accessible to the current cluster for importing indexes.</p><p>Some useful elasticsearch endpoints:</p><ul><li>List available indices</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://&lt;escoordinator&gt;:9200/_cat/indices
</span></span></code></pre></div><ul><li>Import an index from a remote cluster:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#000>remoteost</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$1</span>
</span></span><span style=display:flex><span><span style=color:#000>indexName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -H <span style=color:#4e9a06>&#39;Content-Type: application/json&#39;</span> -X POST http://e03u08.int.janelia.org:9200/_reindex -d <span style=color:#4e9a06>&#34;{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    \&#34;source\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        \&#34;remote\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            \&#34;host\&#34;: \&#34;http://</span><span style=color:#4e9a06>${</span><span style=color:#000>remoteHost</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:9200\&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        },
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        \&#34;index\&#34;: \&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>indexName</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>\&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        \&#34;query\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            \&#34;match_all\&#34;: {}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        }
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    },
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    \&#34;dest\&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        \&#34;index\&#34;: \&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>indexName</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>\&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    }
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}&#34;</span>
</span></span></code></pre></div><ul><li>Export kibana objects</li></ul><p>Here&rsquo;s an example to export kibana visualizations but the command is identical for any one of [config, index-pattern, visualization, search, dashboard, url] - just set the appropriate type</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://&lt;oldkibanahost&gt;:5601/api/saved_objects/_export -H <span style=color:#4e9a06>&#39;kbn-xsrf: true&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>     -H <span style=color:#4e9a06>&#39;Content-Type: application/json&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>     -d <span style=color:#4e9a06>&#39;{&#34;type&#34;: &#34;visualization&#34; }&#39;</span> &gt; local/kibana-visualizations.ndjson
</span></span></code></pre></div><ul><li>To import</li></ul><p>Use the file generated by the above export command and run</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST http://e03u06.int.janelia.org:5601/api/saved_objects/_import <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    -H <span style=color:#4e9a06>&#39;kbn-xsrf: true&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    --form <span style=color:#000>file</span><span style=color:#ce5c00;font-weight:700>=</span>@local/kibana-visualizations.ndjson
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-a8d56f9f9ba6cf350fea8d567173c3e0>6 - Self-signed Certificates</h1><div class=lead>Using self-signed server certificates</div><p>A self-signed certificate is automatically generated during the <code>init-filesystem</code> step of a jacs-cm installation. For production use, it is recommended that you replace this certificate with a real one. The self-signed certificate is less secure, and it requires some extra steps to get working.</p><p>In order to connect to <a href=https://HOST1>https://HOST1</a>, you need to accept the certificate in the browser. This differs by browser.</p><p>Then, in order to allow the Workstation to accept the certificate, it needs to be added to Java&rsquo;s keystore. For this, you will need the certificate on the desktop computer where you are running the Workstation. You can either export it from the browser, or copy it over from the server. On the server, it is located in <code>$CONFIG_DIR/certs/cert.crt</code>. Once you have the certificate, you can import it using Java&rsquo;s keytool.</p><h2 id=windows>Windows</h2><p>On Windows, click Start and type &ldquo;cmd&rdquo; to find the Command Prompt, then right-click it and select &ldquo;Run as administrator&rdquo;. You need to find out where your JVM is installed by looking under C:\Program Files\Zulu. Then, import the certificate. Here it&rsquo;s assumed the cert was saved to the current working directory:</p><pre tabindex=0><code>C:\&gt; &#34;C:\Program Files\Zulu\zulu-8\bin\keytool.exe&#34; -import -alias mouse1selfcert -file cert.crt -keystore &#34;C:\Program Files\Zulu\zulu-8\jre\lib\security\cacerts&#34; -keypass changeit -storepass changeit
</code></pre><p>The <strong>alias</strong> should be a descriptive name that will be used later if you want to remove or view the certificate. The password for the JVM keystore is actually &ldquo;changeit&rdquo;, so don&rsquo;t change the <strong>keypass</strong> or <strong>storepass</strong> values above.</p><h2 id=mac-or-linux>Mac or Linux</h2><p>First, you need to know where the JVM is located. You can use the same method that the Workstation uses to locate the JVM. This ensures you are modifying the correct one. Open a Terminal and type:</p><pre tabindex=0><code>export JDK_HOME=`/usr/libexec/java_home -v 1.8`
</code></pre><p>Now you can import the certificate into the keystore. Here it&rsquo;s assumed the cert was saved to the desktop:</p><pre tabindex=0><code>sudo keytool -import -v -trustcacerts -alias mouse1 -file ~/Desktop/cert.crt -keystore $JDK_HOME/jre/lib/security/cacerts -keypass changeit -storepass changeit
</code></pre><p>The <strong>alias</strong> should be a descriptive name that will be used later if you want to remove or view the certificate. The password for the JVM keystore is actually &ldquo;changeit&rdquo;, so don&rsquo;t change the <strong>keypass</strong> or <strong>storepass</strong> values above.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-92ef9d692f28e2663500b1b1f2e1e902>7 - Storage volumes</h1><div class=lead>Managing storage volumes on JADE</div><p>The Workstation/JACS system relies on JADE for its storage API.</p><h2 id=adding-a-new-storage-volume>Adding a new Storage Volume</h2><p><strong>Add bootstrap to the JADE configuration</strong></p><p>On HOST1, edit /opt/jacs/config/jade/config.properties and add a block for your new volume, for example:</p><pre tabindex=0><code>StorageVolume.s3data.RootDir=/s3data
StorageVolume.s3data.VirtualPath=/s3jade
StorageVolume.s3data.Shared=true
StorageVolume.s3data.Tags=aws,cloud
StorageVolume.s3data.VolumePermissions=READ,WRITE,DELETE
</code></pre><p>The properties configure the volume as follows:</p><ul><li>RootDir: defines the actual path to the data on disk</li><li>VirtualPath: optionally defines a virtual path which is mapped to the actual path</li><li>Shared: true if the volume should be accessible to all volumes</li><li>Tags: tags used by applications to find appropriate volumes</li><li>VolumePermissions: list of operations that JADE can execute (READ,WRITE,DELETE)</li></ul><p>Also add your volume to StorageAgent.BootstrappedVolumes, so that it will be created the next time the service is restarted.</p><p><strong>Mount the path into the containers</strong></p><p>Edit the compose/swarm files for your deployment and mount the volume path as a Docker volume. For example, if your <code>DEPLOYMENT</code> is jacs, and <code>STAGE</code> is dev, you must edit these two files:</p><p><code>deployments/jacs/docker-compose.dev.yml</code>
<code>deployments/jacs/docker-swarm.dev.yml</code></p><p>You should add your volume for all services <code>jade-agent&lt;N></code> which you want to service that volume.</p><p>For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>jade-agent1</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>/data/s3data:/s3data:shared</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Restart the stack after making the changes above and the volume will be created when the JADE worker starts.</p><h2 id=host-specific-volumes>Host-specific Volumes</h2><p>By default, all JADE agents are configured to serve all volumes in the database. You can use <code>StorageAgent.ServedVolumes</code> to control which volumes are served by which hosts.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7a8952308cdb3a7af0e8db8edef7117c>8 - Data import</h1><div class=lead>How to convert data into Horta format</div><p>In principle, any 3d volumetric data can be imported into the MouseLight Workstation.
At this moment we only provide some very basic tools for converting only TIFF format images into the expected format on disk. Another limitation of the current tools is that the entire volume must be in a single tiff file (per channel)</p><p>The imagery for MouseLight Workstation is a directory containing TIFF and KTX images organized into octrees. JACS compute includes a a service that can generate the octree data from a single volume TIFF file. If there is more than 1 channel, the channels are numbered 0 .. n-1 and each channel is expected to be in its own file. For example if you have 2 channels you would have two tiff files:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/path/to/volume/volume.0.tiff
</span></span><span style=display:flex><span>/path/to/volume/volume.1.tiff
</span></span></code></pre></div><p>The import service requires docker or singularity installed because the actual conversion services are packaged in two docker containers - one that generates a TIFF octree and the other one that takes the TIFF octree and converts the octant channel images into the correspomding ktx blocks.</p><p>Currently pre-built containers for tiff octree tool and ktx tool are only available at Janelia&rsquo;s internal registry, but the containers build files are available at <a href=https://github.com/JaneliaSciComp/jacs-tools-docker.git>https://github.com/JaneliaSciComp/jacs-tools-docker.git</a> in the &rsquo;tiff_octree&rsquo; and &lsquo;ktx_octree&rsquo; subdirectories, respectively. KTX tool container can also be built from <a href=https://github.com/JaneliaSciComp/pyktx.git>https://github.com/JaneliaSciComp/pyktx.git</a>.</p><p>Generating the sample octree requires only a JACS Async service call which is a simple HTTP REST call that can be done using curl or Postman. This service can also be invoked from the JACS dashboard <a href=http://api-gateway-host:8080>http://api-gateway-host:8080</a> by going to the &ldquo;Services List&rdquo; after Login and selecting &ldquo;lvDataImport&rdquo;. The dashboard should also offer a brief description of each argument.</p><p>curl invocation to run the service with singularity (this is the JACS default):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  https://api-gateway-host/SCSW/JACS2AsyncServices/v2/async-services/lvDataImport <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -H <span style=color:#4e9a06>&#39;Accept: application/json&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -H <span style=color:#4e9a06>&#39;Content-Type: application/json&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -H <span style=color:#4e9a06>&#39;Authorization: Bearer Your_Token&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -d <span style=color:#4e9a06>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;args&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-containerProcessor&#34;, &#34;singularity&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-inputDir&#34;, &#34;/path/to/volumeData&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-inputFilenamePattern&#34;, &#34;test.{channel}.tif&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-outputDir&#34;, &#34;/path/to/lvv/sampleData&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-channels&#34;, &#34;0,1&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-levels&#34;, &#34;4&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-voxelSize&#34;, &#34;1,1,1&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-subtreeLengthForSubjobSplitting&#34;, 2,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-tiffOctreeContainerImage&#34;, &#34;docker://registry.int.janelia.org/jacs-scripts/octree:1.0&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                &#34;-ktxOctreeContainerImage&#34;, &#34;docker://registry.int.janelia.org/jacs-scripts/pyktx:1.0&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        ],
</span></span></span><span style=display:flex><span><span style=color:#4e9a06> &#34;resources&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06> }
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#39;</span>
</span></span></code></pre></div><p>curl invocation to run the service with docker:</p><pre tabindex=0><code>curl -X POST \
  https://api-gateway-host/SCSW/JACS2AsyncServices/v2/lvDataImport \
  -H &#39;Accept: application/json&#39; \
  -H &#39;Content-Type: application/json&#39; \
  -H &#39;Authorization: Bearer Your_Token&#39; \
  -d &#39;{
 &#34;args&#34;: [
  &#34;-containerProcessor&#34;, &#34;docker&#34;,
  &#34;-inputDir&#34;, &#34;/path/to/volumeData&#34;,
                &#34;-inputFilenamePattern&#34;, &#34;default.{channel}.tif&#34;,
  &#34;-outputDir&#34;, &#34;/path/to/lvv/sampleData&#34;,
  &#34;-channels&#34;, &#34;0&#34;,
  &#34;-levels&#34;, &#34;3&#34;,
  &#34;-voxelSize&#34;, &#34;1,1,1&#34;,
  &#34;-subtreeLengthForSubjobSplitting&#34;, 3,
  &#34;-tiffOctreeContainerImage&#34;, &#34;registry.int.janelia.org/jacs-scripts/octree:1.0&#34;,
  &#34;-ktxOctreeContainerImage&#34;, &#34;registry.int.janelia.org/jacs-scripts/pyktx:1.0&#34;
 ],
 &#34;resources&#34;: {
 }
}
&#39;
</code></pre><h3 id=arguments-description>Arguments description</h3><ul><li>containerProcessor - which container runtime to use docker or singularity</li><li>inputDir - path to original volume data</li><li>inputFileNamePattern - original tiff name. Notice that if you have multiple channels and the channel is anywhere in the name you can use <code>{channel}</code> which will be replaced with the actual channel number.</li><li>outputDir - where the octree will be generated - typically this is the sample data directory that will be imported in the workstation</li><li>channels - specifies a list of all available channels, e.g. &lsquo;0,1&rsquo; if there are two channels or &lsquo;0&rsquo; if there is only 1 channel.</li><li>levels - the number of octree levels. This is left up to the user and the service will not try to figure out the optimum value for the number of octree levels.</li><li>voxelSize - specifies the voxel size in um.</li><li>tiffOctreeContainerImage - tiff octree container image. Not that the format is slightly different for specifying the image name if docker is used or if singularity is used. Since singularity supports docker images, if singularity runtime is used you need to explictily specify that the image is a docker image.</li><li>ktxOctreeContainerImage - ktx octree container image. See above regarding the format based on container processor type.</li><li>subtreeLengthForSubjobSplitting - this parameter applies only for the ktx processor and it tells the service how to split the job and it has a default value of 5. The conversion process typically starts at a certain node and it performs tiff to ktx conversion for a specified number of levels. If you start a process at the root and convert all levels the job may take a while so if you want you have the option to parallelize it by going only for a limited number of levels from the root and start new jobs from all nodes at the level equal with the subtree depth. For example if you have 8 levels and you set <code>subtreeLengthForSubjobSplitting</code> to <code>3</code> then KTX conversion will start <code>1 + 8^3 + 8^6 = 1 + 512 + 262144 = 262657</code> jobs with the following parameters:
<code>"" 3, "111" 3, "112" 3, ..., "118" 3, ..., "888" 3, ..., "111111" 3, ..., "888888" 3</code>
If you leave the default (<code>subtreeLengthForSubjobSplitting=5</code>) then the KTX conversion will start only <code>1 + 8^5 = 32769</code> jobs (<code>"11111" 5, ..., "88888" 5</code>)</li></ul><p>Note that the service invocation requires authentication so before you invoke it, you need to obtain an JWS token from the authentication service - see the <a href=../swarmdeployment>Verify Functionality section on this page</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6d70c3f179823392b17699c06103fb1a>9 - Troubleshooting</h1><div class=lead>Common issues and solutions</div><h2 id=docker>Docker</h2><p>These are some useful commands for troubleshooting Docker:</p><p>View logs for Docker daemon</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo journalctl -fu docker
</span></span></code></pre></div><p>Restart the Docker daemon</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart docker
</span></span></code></pre></div><p>Remove all Docker objects, including unused containers/networks/etc.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker system prune -a
</span></span></code></pre></div><h2 id=swarm-gui>Swarm GUI</h2><p>If you would like to see the Swarm&rsquo;s status in a web-based GUI, we recommend installing <a href=https://swarmpit.io>Swarmpit</a>. It&rsquo;s a single command to deploy, and it works well with the JACS stack.</p><h2 id=common-issues>Common issues</h2><h3 id=config-variable-not-set>config variable not set</h3><p>If you see a lot of errors or warnings similar to the ones below, first check that the <code>.env</code> file was generated correctly - it should have all environment variables from .env.config, present and set. If it is not just remove it and try the commands again. It is possible that you may have run a command like <code>./manage.sh init-filesystems</code> before the swarm cluster was available.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;CONFIG_DIR&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;DATA_DIR&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;DB_DIR&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;BACKUPS_DIR&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;CERT_SUBJ&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;DEPLOYMENT&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;MONGODB_SECRET_KEY&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;API_GATEWAY_EXPOSED_HOST&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;RABBITMQ_EXPOSED_HOST&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;RABBITMQ_USER&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;RABBITMQ_PASSWORD&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;MAIL_SERVER&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;NAMESPACE&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;REDUNDANT_STORAGE&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;REDUNDANT_STORAGE&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;NON_REDUNDANT_STORAGE&#34;</span> variable is not set. Defaulting to a blank string.
</span></span><span style=display:flex><span>WARN<span style=color:#ce5c00;font-weight:700>[</span>0000<span style=color:#ce5c00;font-weight:700>]</span> The <span style=color:#4e9a06>&#34;NON_REDUNDANT_STORAGE&#34;</span> variable is not set. Defaulting to a blank string.
</span></span></code></pre></div><h3 id=network-not-found>&ldquo;network not found&rdquo;</h3><p>If you see an intermittent error like this, just retry the command again:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>failed to create service jacs-cm_jacs-sync: Error response from daemon: network jacs-cm_jacs-net not found
</span></span></code></pre></div><h3 id=bind-errors-during-init-filesystems>bind errors during init-filesystems</h3><p>If during <code>init-filesystems</code> you see an error that the config folder could not be bound on a particular node of the swarm cluster, make sure you did not forget to create the config and db directories on each node that is part of the swarm. The directories must exist in order for docker to be able to mount the corresponding volumes.
After you created all folders if you already ran <code>./manage.sh init-filesystems</code> and it failed before you run it again stop it using</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh stop
</span></span></code></pre></div><p>and then you can try to re-run it</p><h2 id=restful-services>RESTful services</h2><p>You can access the RESTful services from the command line. Obtain a JWT token like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.sh login
</span></span></code></pre></div><p>The default admin account is called &ldquo;root&rdquo; with password &ldquo;root&rdquo; for deployments with self-contained authentication.</p><p>Now you can access any of the RESTful APIs on the gateway, for instance:</p><pre tabindex=0><code>export TOKEN=&lt;enter token here&gt;
curl -k --request GET --url https://${API_GATEWAY_EXPOSED_HOST}/SCSW/JACS2AsyncServices/v2/services/metadata --header &#34;Content-Type: application/json&#34; --header &#34;Authorization: Bearer $TOKEN&#34;
</code></pre></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Email us" aria-label="Email us"><a target=_blank rel=noopener href=mailto:hortacloud@janelia.hhmi.org aria-label="Email us"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=X aria-label=X><a target=_blank rel=noopener href=https://twitter.com/HortaCloud aria-label=X><i class="fab fa-twitter"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Project management board" aria-label="Project management board"><a target=_blank rel=noopener href=https://github.com/orgs/JaneliaSciComp/projects/3 aria-label="Project management board"><i class="fas fa-tasks"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/JaneliaSciComp/hortacloud aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>Howard Hughes Medical Institute</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://www.hhmi.org/privacy-policy target=_blank rel=noopener>Privacy Policy & Cookie Notice</a></span></div></div></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>